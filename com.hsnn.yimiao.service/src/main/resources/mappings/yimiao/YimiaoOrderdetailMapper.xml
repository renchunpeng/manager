<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hsnn.medstgmini.yimiao.dao.YimiaoOrderdetailDao">
	<resultMap type="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail" id="BaseResultMap">
        <result property="orderdetailId" column="ORDERDETAIL_ID" javaType="String"/>
        <result property="orderId" column="ORDER_ID" javaType="String"/>
        <result property="procurecatalogId" column="PROCURECATALOG_ID" javaType="Integer"/>
        <result property="goodsId" column="GOODS_ID" javaType="String"/>
        <result property="productName" column="PRODUCT_NAME" javaType="String"/>
        <result property="productSpelName" column="PRODUCT_SPEL_NAME" javaType="String"/>
        <result property="productWbName" column="PRODUCT_WB_NAME" javaType="String"/>
        <result property="goodsName" column="GOODS_NAME" javaType="String"/>
        <result property="medicinemodel" column="MEDICINEMODEL" javaType="String"/>
        <result property="outlook" column="OUTLOOK" javaType="String"/>
        <result property="factor" column="FACTOR" javaType="Integer"/>
        <result property="materialName" column="MATERIAL_NAME" javaType="String"/>
        <result property="unit" column="UNIT" javaType="String"/>
        <result property="companyIdSc" column="COMPANY_ID_SC" javaType="String"/>
        <result property="companyNameSc" column="COMPANY_NAME_SC" javaType="String"/>
        <result property="splitCompanyName" column="SPLIT_COMPANY_NAME" javaType="String"/>
        <result property="trustCompanyName" column="TRUST_COMPANY_NAME" javaType="String"/>
        <result property="companyIdTb" column="COMPANY_ID_TB" javaType="String"/>
        <result property="companyNameTb" column="COMPANY_NAME_TB" javaType="String"/>
        <result property="middlePack" column="MIDDLE_PACK" javaType="Integer"/>
        <result property="maxPack" column="MAX_PACK" javaType="Integer"/>
        <result property="isBaseDrug" column="IS_BASE_DRUG" javaType="Integer"/>
        <result property="qualityLevel" column="QUALITY_LEVEL" javaType="String"/>
        <result property="purchaseType" column="PURCHASE_TYPE" javaType="Integer"/>
        <result property="sourceId" column="SOURCE_ID" javaType="Integer"/>
        <result property="sourceName" column="SOURCE_NAME" javaType="String"/>
        <result property="bidPrice" column="BID_PRICE" javaType="BigDecimal"/>
        <result property="usingRang" column="USING_RANG" javaType="Integer"/>
        <result property="hospitalId" column="HOSPITAL_ID" javaType="String"/>
        <result property="hospitalName" column="HOSPITAL_NAME" javaType="String"/>
        <result property="hospitalDepartmentId" column="HOSPITAL_DEPARTMENT_ID" javaType="Integer"/>
        <result property="hospitalDepartmentName" column="HOSPITAL_DEPARTMENT_NAME" javaType="String"/>
        <result property="adminAreaIdStatisticsDrug" column="ADMIN_AREA_ID_STATISTICS_DRUG" javaType="Integer"/>
        <result property="adminAreaNameDrug" column="ADMIN_AREA_NAME_DRUG" javaType="String"/>
        <result property="adminAreaIdDrug" column="ADMIN_AREA_ID_DRUG" javaType="Integer"/>
        <result property="areaId" column="area_Id" javaType="String"/>
        <result property="areaName" column="area_Name" javaType="String"/>
        <result property="belongOrgName" column="BELONG_ORG_NAME" javaType="String"/>
        <result property="orderType" column="ORDER_TYPE" javaType="Integer"/>
        <result property="orderName" column="ORDER_NAME" javaType="String"/>
        <result property="submitTime" column="SUBMIT_TIME" javaType="Date"/>
        <result property="filingId" column="FILING_ID" javaType="Integer"/>
        <result property="companyIdPs" column="COMPANY_ID_PS" javaType="String"/>
        <result property="companyNamePs" column="COMPANY_NAME_PS" javaType="String"/>
        <result property="purchasePrice" column="PURCHASE_PRICE" javaType="BigDecimal"/>
        <result property="purchaseCount" column="PURCHASE_COUNT" javaType="Integer"/>
        <result property="purchaseAmount" column="PURCHASE_AMOUNT" javaType="BigDecimal"/>
        <result property="isRead" column="IS_READ" javaType="Integer"/>
        <result property="readUserId" column="READ_USER_ID" javaType="String"/>
        <result property="readUserName" column="READ_USER_NAME" javaType="String"/>
        <result property="readTime" column="READ_TIME" javaType="Date"/>
        <result property="confirmUserId" column="CONFIRM_USER_ID" javaType="String"/>
        <result property="confirmUserName" column="CONFIRM_USER_NAME" javaType="String"/>
        <result property="confirmTime" column="CONFIRM_TIME" javaType="Date"/>
        <result property="confirmState" column="CONFIRM_STATE" javaType="Integer"/>
        <result property="orderdetailState" column="ORDERDETAIL_STATE" javaType="Integer"/>
        <result property="refuseReason" column="REFUSE_REASON" javaType="String"/>
        <result property="detailDistributeAddress" column="DETAIL_DISTRIBUTE_ADDRESS" javaType="String"/>
        <result property="totalDistributeCount" column="TOTAL_DISTRIBUTE_COUNT" javaType="Integer"/>
        <result property="totalDistributeAmount" column="TOTAL_DISTRIBUTE_AMOUNT" javaType="BigDecimal"/>
        <result property="totalWarehouseCount" column="TOTAL_WAREHOUSE_COUNT" javaType="Integer"/>
        <result property="totalWarehouseAmount" column="TOTAL_WAREHOUSE_AMOUNT" javaType="BigDecimal"/>
        <result property="totalReturnAmount" column="TOTAL_RETURN_AMOUNT" javaType="BigDecimal"/>
        <result property="totalReturnCount" column="TOTAL_RETURN_COUNT" javaType="Integer"/>
        <result property="isUsing" column="IS_USING" javaType="Integer"/>
        <result property="compRatio" column="COMP_RATIO" javaType="BigDecimal"/>
        <result property="orderCustomInfo" column="ORDER_CUSTOM_INFO" javaType="String"/>
        <result property="addUserId" column="ADD_USER_ID" javaType="String"/>
        <result property="addUserName" column="ADD_USER_NAME" javaType="String"/>
        <result property="addTime" column="ADD_TIME" javaType="Date"/>
        <result property="lastUpdateUserId" column="LAST_UPDATE_USER_ID" javaType="String"/>
        <result property="lastUpdateUserName" column="LAST_UPDATE_USER_NAME" javaType="String"/>
        <result property="lastUpdateTime" column="LAST_UPDATE_TIME" javaType="Date"/>
        <result property="wtCompanyNamePs" column="WT_COMPANY_NAME_PS" javaType="String"/>
        <result property="wcountOne" column="wcountOne" javaType="String"/>
        <result property="wamountOne" column="wamountOne" javaType="String"/>
        <result property="cratioOne" column="cratioOne" javaType="String"/>
        <result property="wcountTwo" column="wcountTwo" javaType="String"/>
        <result property="wamountTwo" column="wamountTwo" javaType="String"/>
        <result property="cratioTwo" column="cratioTwo" javaType="String"/>
        <result property="submitMonth" column="submitMonth" javaType="String"/>
        
        <result property="tjareaName" column="tjareaName" javaType="String"/>
        <result property="cghospitalName" column="cghospitalName" javaType="String"/>
        <result property="cgsubmitTime" column="cgsubmitTime" javaType="String"/>
        <result property="cgconfirmTime" column="cgconfirmTime" javaType="String"/>
        <result property="thhospitalName" column="thhospitalName" javaType="String"/>
        <result property="thsubmitTime" column="thsubmitTime" javaType="String"/>
        <result property="thconfirmTime" column="thconfirmTime" javaType="String"/>
    </resultMap>

    <sql id="full-columns">
        t.ORDERDETAIL_ID,
        t.ORDER_ID,
        t.PROCURECATALOG_ID,
        t.GOODS_ID,
        t.PRODUCT_NAME,
        t.PRODUCT_SPEL_NAME,
        t.PRODUCT_WB_NAME,
        t.GOODS_NAME,
        t.MEDICINEMODEL,
        t.OUTLOOK,
        t.FACTOR,
        t.MATERIAL_NAME,
        t.UNIT,
        t.COMPANY_ID_SC,
        t.COMPANY_NAME_SC,
        t.SPLIT_COMPANY_NAME,
        t.TRUST_COMPANY_NAME,
        t.COMPANY_ID_TB,
        t.COMPANY_NAME_TB,
        t.MIDDLE_PACK,
        t.MAX_PACK,
        t.IS_BASE_DRUG,
        t.QUALITY_LEVEL,
        t.PURCHASE_TYPE,
        t.SOURCE_ID,
        t.SOURCE_NAME,
        t.BID_PRICE,
        t.USING_RANG,
        t.HOSPITAL_ID,
        t.HOSPITAL_NAME,
        t.HOSPITAL_DEPARTMENT_ID,
        t.HOSPITAL_DEPARTMENT_NAME,
        t.ADMIN_AREA_ID_STATISTICS_DRUG,
        t.ADMIN_AREA_NAME_DRUG,
        t.ADMIN_AREA_ID_DRUG,
        t.BELONG_ORG_NAME,
        t.ORDER_TYPE,
        t.ORDER_NAME,
        t.SUBMIT_TIME,
        t.FILING_ID,
        t.COMPANY_ID_PS,
        t.COMPANY_NAME_PS,
        t.PURCHASE_PRICE,
        t.PURCHASE_COUNT,
        t.PURCHASE_AMOUNT,
        t.IS_READ,
        t.READ_USER_ID,
        t.READ_USER_NAME,
        t.READ_TIME,
        t.CONFIRM_USER_ID,
        t.CONFIRM_USER_NAME,
        t.CONFIRM_TIME,
        t.CONFIRM_STATE,
        t.ORDERDETAIL_STATE,
        t.REFUSE_REASON,
        t.DETAIL_DISTRIBUTE_ADDRESS,
        t.TOTAL_DISTRIBUTE_COUNT,
        t.TOTAL_DISTRIBUTE_AMOUNT,
        t.TOTAL_WAREHOUSE_COUNT,
        t.TOTAL_WAREHOUSE_AMOUNT,
        t.TOTAL_RETURN_AMOUNT,
        t.TOTAL_RETURN_COUNT,
        t.IS_USING,
        t.COMP_RATIO,
        t.ORDER_CUSTOM_INFO,
        t.ADD_USER_ID,
        t.ADD_USER_NAME,
        t.ADD_TIME,
        t.LAST_UPDATE_USER_ID,
        t.LAST_UPDATE_USER_NAME,
        t.LAST_UPDATE_TIME,
        t.WT_COMPANY_NAME_PS
	</sql>

    <select id="get" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        WHERE t.ORDERDETAIL_ID = #{value}
    </select>

    <select id="getByOrder" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        WHERE t.ORDER_ID = #{value}
    </select>

    <insert id="save" parameterType="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail">
		INSERT INTO YIMIAO_ORDERDETAIL(
				ORDERDETAIL_ID,
	            ORDER_ID ,
	            PROCURECATALOG_ID ,
	            GOODS_ID ,
	            PRODUCT_NAME ,
	            PRODUCT_SPEL_NAME ,
	            PRODUCT_WB_NAME ,
	            GOODS_NAME ,
	            MEDICINEMODEL ,
	            OUTLOOK ,
	            FACTOR ,
	            MATERIAL_NAME ,
	            UNIT ,
	            COMPANY_ID_SC ,
	            COMPANY_NAME_SC ,
	            SPLIT_COMPANY_NAME ,
	            TRUST_COMPANY_NAME ,
	            COMPANY_ID_TB ,
	            COMPANY_NAME_TB ,
	            MIDDLE_PACK ,
	            MAX_PACK ,
	            IS_BASE_DRUG ,
	            QUALITY_LEVEL ,
	            PURCHASE_TYPE ,
	            SOURCE_ID ,
	            SOURCE_NAME ,
	            BID_PRICE ,
	            USING_RANG ,
	            HOSPITAL_ID ,
	            HOSPITAL_NAME ,
	            HOSPITAL_DEPARTMENT_ID ,
	            HOSPITAL_DEPARTMENT_NAME ,
	            ADMIN_AREA_ID_STATISTICS_DRUG ,
	            ADMIN_AREA_NAME_DRUG ,
	            ADMIN_AREA_ID_DRUG ,
	            BELONG_ORG_NAME ,
	            ORDER_TYPE ,
	            ORDER_NAME ,
	            SUBMIT_TIME ,
	            FILING_ID ,
	            COMPANY_ID_PS ,
	            COMPANY_NAME_PS ,
	            PURCHASE_PRICE ,
	            PURCHASE_COUNT ,
	            PURCHASE_AMOUNT ,
	            IS_READ ,
	            READ_USER_ID ,
	            READ_USER_NAME ,
	            READ_TIME ,
	            CONFIRM_USER_ID ,
	            CONFIRM_USER_NAME ,
	            CONFIRM_TIME ,
	            CONFIRM_STATE ,
	            ORDERDETAIL_STATE ,
	            REFUSE_REASON ,
	            DETAIL_DISTRIBUTE_ADDRESS ,
	            TOTAL_DISTRIBUTE_COUNT ,
	            TOTAL_DISTRIBUTE_AMOUNT ,
	            TOTAL_WAREHOUSE_COUNT ,
	            TOTAL_WAREHOUSE_AMOUNT ,
	            TOTAL_RETURN_AMOUNT ,
	            TOTAL_RETURN_COUNT ,
	            IS_USING ,
	            COMP_RATIO ,
	            ORDER_CUSTOM_INFO ,
	            ADD_USER_ID ,
	            ADD_USER_NAME ,
	            ADD_TIME ,
	            LAST_UPDATE_USER_ID ,
	            LAST_UPDATE_USER_NAME ,
	            LAST_UPDATE_TIME,
	            WT_COMPANY_NAME_PS
		)
		VALUES (
				#{orderdetailId},
	        	#{orderId},
	        	#{procurecatalogId},
	        	#{goodsId},
	        	#{productName},
	        	#{productSpelName},
	        	#{productWbName},
	        	#{goodsName},
	        	#{medicinemodel},
	        	#{outlook},
	        	#{factor},
	        	#{materialName},
	        	#{unit},
	        	#{companyIdSc},
	        	#{companyNameSc},
	        	#{splitCompanyName},
	        	#{trustCompanyName},
	        	#{companyIdTb},
	        	#{companyNameTb},
	        	#{middlePack},
	        	#{maxPack},
	        	#{isBaseDrug},
	        	#{qualityLevel},
	        	#{purchaseType},
	        	#{sourceId},
	        	#{sourceName},
	        	#{bidPrice},
	        	#{usingRang},
	        	#{hospitalId},
	        	#{hospitalName},
	        	#{hospitalDepartmentId},
	        	#{hospitalDepartmentName},
	        	#{adminAreaIdStatisticsDrug},
	        	#{adminAreaNameDrug},
	        	#{adminAreaIdDrug},
	        	#{belongOrgName},
	        	#{orderType},
	        	#{orderName},
	        	#{submitTime},
	        	#{filingId},
	        	#{companyIdPs},
	        	#{companyNamePs},
	        	#{purchasePrice},
	        	#{purchaseCount},
	        	#{purchaseAmount},
	        	#{isRead},
	        	#{readUserId},
	        	#{readUserName},
	        	#{readTime},
	        	#{confirmUserId},
	        	#{confirmUserName},
	        	#{confirmTime},
	        	#{confirmState},
	        	#{orderdetailState},
	        	#{refuseReason},
	        	#{detailDistributeAddress},
	        	#{totalDistributeCount},
	        	#{totalDistributeAmount},
	        	#{totalWarehouseCount},
	        	#{totalWarehouseAmount},
	        	#{totalReturnAmount},
	        	#{totalReturnCount},
	        	#{isUsing},
	        	#{compRatio},
	        	#{orderCustomInfo},
	        	#{addUserId},
	        	#{addUserName},
	        	#{addTime},
	        	#{lastUpdateUserId},
	        	#{lastUpdateUserName},
	        	#{lastUpdateTime},
	        	#{wtCompanyNamePs}
		)
	</insert>


    <update id="update" parameterType="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail">
        UPDATE YIMIAO_ORDERDETAIL
        <set>
            ORDER_ID = #{orderId},
            PROCURECATALOG_ID = #{procurecatalogId},
            GOODS_ID = #{goodsId},
            PRODUCT_NAME = #{productName},
            PRODUCT_SPEL_NAME = #{productSpelName},
            PRODUCT_WB_NAME = #{productWbName},
            GOODS_NAME = #{goodsName},
            MEDICINEMODEL = #{medicinemodel},
            OUTLOOK = #{outlook},
            FACTOR = #{factor},
            MATERIAL_NAME = #{materialName},
            UNIT = #{unit},
            COMPANY_NAME_SC = #{companyNameSc},
            SPLIT_COMPANY_NAME = #{splitCompanyName},
            TRUST_COMPANY_NAME = #{trustCompanyName},
            COMPANY_ID_TB = #{companyIdTb},
            COMPANY_NAME_TB = #{companyNameTb},
            MIDDLE_PACK = #{middlePack},
            MAX_PACK = #{maxPack},
            IS_BASE_DRUG = #{isBaseDrug},
            QUALITY_LEVEL = #{qualityLevel},
            PURCHASE_TYPE = #{purchaseType},
            SOURCE_ID = #{sourceId},
            SOURCE_NAME = #{sourceName},
            BID_PRICE = #{bidPrice},
            USING_RANG = #{usingRang},
            HOSPITAL_ID = #{hospitalId},
            HOSPITAL_NAME = #{hospitalName},
            HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId},
            HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName},
            ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug},
            ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug},
            ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug},
            BELONG_ORG_NAME = #{belongOrgName},
            ORDER_TYPE = #{orderType},
            ORDER_NAME = #{orderName},
            SUBMIT_TIME = #{submitTime},
            FILING_ID = #{filingId},
            COMPANY_ID_PS = #{companyIdPs},
            COMPANY_NAME_PS = #{companyNamePs},
            PURCHASE_PRICE = #{purchasePrice},
            PURCHASE_COUNT = #{purchaseCount},
            PURCHASE_AMOUNT = #{purchaseAmount},
            IS_READ = #{isRead},
            READ_USER_ID = #{readUserId},
            READ_USER_NAME = #{readUserName},
            READ_TIME = #{readTime},
            CONFIRM_USER_ID = #{confirmUserId},
            CONFIRM_USER_NAME = #{confirmUserName},
            CONFIRM_TIME = #{confirmTime},
            CONFIRM_STATE = #{confirmState},
            ORDERDETAIL_STATE = #{orderdetailState},
            REFUSE_REASON = #{refuseReason},
            DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress},
            TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount},
            TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount},
            TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount},
            TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount},
            TOTAL_RETURN_AMOUNT = #{totalReturnAmount},
            TOTAL_RETURN_COUNT = #{totalReturnCount},
            IS_USING = #{isUsing},
            COMP_RATIO = #{compRatio},
            ORDER_CUSTOM_INFO = #{orderCustomInfo},
            ADD_USER_ID = #{addUserId},
            ADD_USER_NAME = #{addUserName},
            ADD_TIME = #{addTime},
            LAST_UPDATE_USER_ID = #{lastUpdateUserId},
            LAST_UPDATE_USER_NAME = #{lastUpdateUserName},
            LAST_UPDATE_TIME = #{lastUpdateTime},
        </set>
        WHERE ORDERDETAIL_ID = #{orderdetailId}
    </update>


    <update id="updateByOrder" parameterType="java.util.List">
        UPDATE YIMIAO_ORDERDETAIL
        <set>
            CONFIRM_STATE = 3,
            IS_USING = 1,
            SUBMIT_TIME=now()
        </set>
        WHERE ORDER_ID IN (
        <foreach collection="list" item="item" index="index" separator=" , ">
            #{item.orderId}
        </foreach>
        ) and (CONFIRM_STATE is null or CONFIRM_STATE = 4)
    </update>


    <update id="updateBySelective" parameterType="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail">
        UPDATE YIMIAO_ORDERDETAIL
        <set>
            <if test="@OGNL@isNotEmpty(orderId)">
                ORDER_ID = #{orderId},
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                PROCURECATALOG_ID = #{procurecatalogId},
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                GOODS_ID = #{goodsId},
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                PRODUCT_NAME = #{productName},
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                PRODUCT_SPEL_NAME = #{productSpelName},
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                PRODUCT_WB_NAME = #{productWbName},
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                GOODS_NAME = #{goodsName},
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                MEDICINEMODEL = #{medicinemodel},
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                OUTLOOK = #{outlook},
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                FACTOR = #{factor},
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                MATERIAL_NAME = #{materialName},
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                UNIT = #{unit},
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                COMPANY_NAME_SC = #{companyNameSc},
            </if>
            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                SPLIT_COMPANY_NAME = #{splitCompanyName},
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                TRUST_COMPANY_NAME = #{trustCompanyName},
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                COMPANY_ID_TB = #{companyIdTb},
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                COMPANY_NAME_TB = #{companyNameTb},
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                MIDDLE_PACK = #{middlePack},
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                MAX_PACK = #{maxPack},
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                IS_BASE_DRUG = #{isBaseDrug},
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                QUALITY_LEVEL = #{qualityLevel},
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                PURCHASE_TYPE = #{purchaseType},
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                SOURCE_ID = #{sourceId},
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                SOURCE_NAME = #{sourceName},
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                BID_PRICE = #{bidPrice},
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                USING_RANG = #{usingRang},
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                HOSPITAL_ID = #{hospitalId},
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                HOSPITAL_NAME = #{hospitalName},
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId},
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName},
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug},
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug},
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug},
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                BELONG_ORG_NAME = #{belongOrgName},
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                ORDER_TYPE = #{orderType},
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                ORDER_NAME = #{orderName},
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                SUBMIT_TIME = #{submitTime},
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                FILING_ID = #{filingId},
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                COMPANY_ID_PS = #{companyIdPs},
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                COMPANY_NAME_PS = #{companyNamePs},
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                PURCHASE_PRICE = #{purchasePrice},
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                PURCHASE_COUNT = #{purchaseCount},
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                PURCHASE_AMOUNT = #{purchaseAmount},
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                IS_READ = #{isRead},
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                READ_USER_ID = #{readUserId},
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                READ_USER_NAME = #{readUserName},
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                READ_TIME = #{readTime},
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                CONFIRM_USER_ID = #{confirmUserId},
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                CONFIRM_USER_NAME = #{confirmUserName},
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                CONFIRM_TIME = #{confirmTime},
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                CONFIRM_STATE = #{confirmState},
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                ORDERDETAIL_STATE = #{orderdetailState},
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                REFUSE_REASON = #{refuseReason},
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress},
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount},
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount},
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount},
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount},
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                TOTAL_RETURN_AMOUNT = #{totalReturnAmount},
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                TOTAL_RETURN_COUNT = #{totalReturnCount},
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                IS_USING = #{isUsing},
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                COMP_RATIO = #{compRatio},
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                ORDER_CUSTOM_INFO = #{orderCustomInfo},
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                ADD_USER_ID = #{addUserId},
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                ADD_USER_NAME = #{addUserName},
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                ADD_TIME = #{addTime},
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                LAST_UPDATE_USER_ID = #{lastUpdateUserId},
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                LAST_UPDATE_USER_NAME = #{lastUpdateUserName},
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                LAST_UPDATE_TIME = #{lastUpdateTime},
            </if>
        </set>
        WHERE ORDERDETAIL_ID = #{orderdetailId}
    </update>

    <delete id="delete" parameterType="java.lang.String">
		DELETE FROM YIMIAO_ORDERDETAIL WHERE  ORDERDETAIL_ID =  #{value}
	</delete>

    <select id="queryAll" parameterType="map" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        left join std_hospital d on d.hospital_id=t.hospital_id
        <where>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND d.AREA_ID = #{areaId}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailId)">
                AND t.ORDERDETAIL_ID = #{orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>

            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>

            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="ratio == 0">
                AND (t.COMP_RATIO <![CDATA[<]]> 1 or t.COMP_RATIO is null)
            </if>
            <if test="ratio == 1">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO YIMIAO_ORDERDETAIL (
        ORDER_ID ,
        PROCURECATALOG_ID ,
        GOODS_ID ,
        PRODUCT_NAME ,
        PRODUCT_SPEL_NAME ,
        PRODUCT_WB_NAME ,
        GOODS_NAME ,
        MEDICINEMODEL ,
        OUTLOOK ,
        FACTOR ,
        MATERIAL_NAME ,
        UNIT ,
        COMPANY_NAME_SC ,
        SPLIT_COMPANY_NAME ,
        TRUST_COMPANY_NAME ,
        COMPANY_ID_TB ,
        COMPANY_NAME_TB ,
        MIDDLE_PACK ,
        MAX_PACK ,
        IS_BASE_DRUG ,
        QUALITY_LEVEL ,
        PURCHASE_TYPE ,
        SOURCE_ID ,
        SOURCE_NAME ,
        BID_PRICE ,
        USING_RANG ,
        HOSPITAL_ID ,
        HOSPITAL_NAME ,
        HOSPITAL_DEPARTMENT_ID ,
        HOSPITAL_DEPARTMENT_NAME ,
        ADMIN_AREA_ID_STATISTICS_DRUG ,
        ADMIN_AREA_NAME_DRUG ,
        ADMIN_AREA_ID_DRUG ,
        BELONG_ORG_NAME ,
        ORDER_TYPE ,
        ORDER_NAME ,
        SUBMIT_TIME ,
        FILING_ID ,
        COMPANY_ID_PS ,
        COMPANY_NAME_PS ,
        PURCHASE_PRICE ,
        PURCHASE_COUNT ,
        PURCHASE_AMOUNT ,
        IS_READ ,
        READ_USER_ID ,
        READ_USER_NAME ,
        READ_TIME ,
        CONFIRM_USER_ID ,
        CONFIRM_USER_NAME ,
        CONFIRM_TIME ,
        CONFIRM_STATE ,
        ORDERDETAIL_STATE ,
        REFUSE_REASON ,
        DETAIL_DISTRIBUTE_ADDRESS ,
        TOTAL_DISTRIBUTE_COUNT ,
        TOTAL_DISTRIBUTE_AMOUNT ,
        TOTAL_WAREHOUSE_COUNT ,
        TOTAL_WAREHOUSE_AMOUNT ,
        TOTAL_RETURN_AMOUNT ,
        TOTAL_RETURN_COUNT ,
        IS_USING ,
        COMP_RATIO ,
        ORDER_CUSTOM_INFO ,
        ADD_USER_ID ,
        ADD_USER_NAME ,
        ADD_TIME ,
        LAST_UPDATE_USER_ID ,
        LAST_UPDATE_USER_NAME ,
        LAST_UPDATE_TIME
        ) VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.orderId},
            #{item.procurecatalogId},
            #{item.goodsId},
            #{item.productName},
            #{item.productSpelName},
            #{item.productWbName},
            #{item.goodsName},
            #{item.medicinemodel},
            #{item.outlook},
            #{item.factor},
            #{item.materialName},
            #{item.unit},
            #{item.companyNameSc},
            #{item.splitCompanyName},
            #{item.trustCompanyName},
            #{item.companyIdTb},
            #{item.companyNameTb},
            #{item.middlePack},
            #{item.maxPack},
            #{item.isBaseDrug},
            #{item.qualityLevel},
            #{item.purchaseType},
            #{item.sourceId},
            #{item.sourceName},
            #{item.bidPrice},
            #{item.usingRang},
            #{item.hospitalId},
            #{item.hospitalName},
            #{item.hospitalDepartmentId},
            #{item.hospitalDepartmentName},
            #{item.adminAreaIdStatisticsDrug},
            #{item.adminAreaNameDrug},
            #{item.adminAreaIdDrug},
            #{item.belongOrgName},
            #{item.orderType},
            #{item.orderName},
            #{item.submitTime},
            #{item.filingId},
            #{item.companyIdPs},
            #{item.companyNamePs},
            #{item.purchasePrice},
            #{item.purchaseCount},
            #{item.purchaseAmount},
            #{item.isRead},
            #{item.readUserId},
            #{item.readUserName},
            #{item.readTime},
            #{item.confirmUserId},
            #{item.confirmUserName},
            #{item.confirmTime},
            #{item.confirmState},
            #{item.orderdetailState},
            #{item.refuseReason},
            #{item.detailDistributeAddress},
            #{item.totalDistributeCount},
            #{item.totalDistributeAmount},
            #{item.totalWarehouseCount},
            #{item.totalWarehouseAmount},
            #{item.totalReturnAmount},
            #{item.totalReturnCount},
            #{item.isUsing},
            #{item.compRatio},
            #{item.orderCustomInfo},
            #{item.addUserId},
            #{item.addUserName},
            #{item.addTime},
            #{item.lastUpdateUserId},
            #{item.lastUpdateUserName},
            #{item.lastUpdateTime}
            )
        </foreach>
    </insert>

    <select id="count" parameterType="map" resultType="int">
        SELECT count(1)
        FROM YIMIAO_ORDERDETAIL t
        <where>
            <if test="@OGNL@isNotEmpty(orderdetailId)">
                AND t.ORDERDETAIL_ID = #{orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME = #{productName}
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK = #{outlook}
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC = #{companyNameSc}
            </if>
            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME = #{hospitalName}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS = #{companyNamePs}
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
        </where>
    </select>

    <update id="updateByParams">
        UPDATE YIMIAO_ORDERDETAIL t
        <set>
            <if test="@OGNL@isNotEmpty(model.orderId)">
                ORDER_ID = #{model.orderId},
            </if>
            <if test="@OGNL@isNotEmpty(model.procurecatalogId)">
                PROCURECATALOG_ID = #{model.procurecatalogId},
            </if>
            <if test="@OGNL@isNotEmpty(model.goodsId)">
                GOODS_ID = #{model.goodsId},
            </if>
            <if test="@OGNL@isNotEmpty(model.productName)">
                PRODUCT_NAME = #{model.productName},
            </if>
            <if test="@OGNL@isNotEmpty(model.productSpelName)">
                PRODUCT_SPEL_NAME = #{model.productSpelName},
            </if>
            <if test="@OGNL@isNotEmpty(model.productWbName)">
                PRODUCT_WB_NAME = #{model.productWbName},
            </if>
            <if test="@OGNL@isNotEmpty(model.goodsName)">
                GOODS_NAME = #{model.goodsName},
            </if>
            <if test="@OGNL@isNotEmpty(model.medicinemodel)">
                MEDICINEMODEL = #{model.medicinemodel},
            </if>
            <if test="@OGNL@isNotEmpty(model.outlook)">
                OUTLOOK = #{model.outlook},
            </if>
            <if test="@OGNL@isNotEmpty(model.factor)">
                FACTOR = #{model.factor},
            </if>
            <if test="@OGNL@isNotEmpty(model.materialName)">
                MATERIAL_NAME = #{model.materialName},
            </if>
            <if test="@OGNL@isNotEmpty(model.unit)">
                UNIT = #{model.unit},
            </if>
            <if test="@OGNL@isNotEmpty(model.companyNameSc)">
                COMPANY_NAME_SC = #{model.companyNameSc},
            </if>
            <if test="@OGNL@isNotEmpty(model.splitCompanyName)">
                SPLIT_COMPANY_NAME = #{model.splitCompanyName},
            </if>
            <if test="@OGNL@isNotEmpty(model.trustCompanyName)">
                TRUST_COMPANY_NAME = #{model.trustCompanyName},
            </if>
            <if test="@OGNL@isNotEmpty(model.companyIdTb)">
                COMPANY_ID_TB = #{model.companyIdTb},
            </if>
            <if test="@OGNL@isNotEmpty(model.companyNameTb)">
                COMPANY_NAME_TB = #{model.companyNameTb},
            </if>
            <if test="@OGNL@isNotEmpty(model.middlePack)">
                MIDDLE_PACK = #{model.middlePack},
            </if>
            <if test="@OGNL@isNotEmpty(model.maxPack)">
                MAX_PACK = #{model.maxPack},
            </if>
            <if test="@OGNL@isNotEmpty(model.isBaseDrug)">
                IS_BASE_DRUG = #{model.isBaseDrug},
            </if>
            <if test="@OGNL@isNotEmpty(model.qualityLevel)">
                QUALITY_LEVEL = #{model.qualityLevel},
            </if>
            <if test="@OGNL@isNotEmpty(model.purchaseType)">
                PURCHASE_TYPE = #{model.purchaseType},
            </if>
            <if test="@OGNL@isNotEmpty(model.sourceId)">
                SOURCE_ID = #{model.sourceId},
            </if>
            <if test="@OGNL@isNotEmpty(model.sourceName)">
                SOURCE_NAME = #{model.sourceName},
            </if>
            <if test="@OGNL@isNotEmpty(model.bidPrice)">
                BID_PRICE = #{model.bidPrice},
            </if>
            <if test="@OGNL@isNotEmpty(model.usingRang)">
                USING_RANG = #{model.usingRang},
            </if>
            <if test="@OGNL@isNotEmpty(model.hospitalId)">
                HOSPITAL_ID = #{model.hospitalId},
            </if>
            <if test="@OGNL@isNotEmpty(model.hospitalName)">
                HOSPITAL_NAME = #{model.hospitalName},
            </if>
            <if test="@OGNL@isNotEmpty(model.hospitalDepartmentId)">
                HOSPITAL_DEPARTMENT_ID = #{model.hospitalDepartmentId},
            </if>
            <if test="@OGNL@isNotEmpty(model.hospitalDepartmentName)">
                HOSPITAL_DEPARTMENT_NAME = #{model.hospitalDepartmentName},
            </if>
            <if test="@OGNL@isNotEmpty(model.adminAreaIdStatisticsDrug)">
                ADMIN_AREA_ID_STATISTICS_DRUG = #{model.adminAreaIdStatisticsDrug},
            </if>
            <if test="@OGNL@isNotEmpty(model.adminAreaNameDrug)">
                ADMIN_AREA_NAME_DRUG = #{model.adminAreaNameDrug},
            </if>
            <if test="@OGNL@isNotEmpty(model.adminAreaIdDrug)">
                ADMIN_AREA_ID_DRUG = #{model.adminAreaIdDrug},
            </if>
            <if test="@OGNL@isNotEmpty(model.belongOrgName)">
                BELONG_ORG_NAME = #{model.belongOrgName},
            </if>
            <if test="@OGNL@isNotEmpty(model.orderType)">
                ORDER_TYPE = #{model.orderType},
            </if>
            <if test="@OGNL@isNotEmpty(model.orderName)">
                ORDER_NAME = #{model.orderName},
            </if>
            <if test="@OGNL@isNotEmpty(model.submitTime)">
                SUBMIT_TIME = #{model.submitTime},
            </if>
            <if test="@OGNL@isNotEmpty(model.filingId)">
                FILING_ID = #{model.filingId},
            </if>
            <if test="@OGNL@isNotEmpty(model.companyIdPs)">
                COMPANY_ID_PS = #{model.companyIdPs},
            </if>
            <if test="@OGNL@isNotEmpty(model.companyNamePs)">
                COMPANY_NAME_PS = #{model.companyNamePs},
            </if>
            <if test="@OGNL@isNotEmpty(model.purchasePrice)">
                PURCHASE_PRICE = #{model.purchasePrice},
            </if>
            <if test="@OGNL@isNotEmpty(model.purchaseCount)">
                PURCHASE_COUNT = #{model.purchaseCount},
            </if>
            <if test="@OGNL@isNotEmpty(model.purchaseAmount)">
                PURCHASE_AMOUNT = #{model.purchaseAmount},
            </if>
            <if test="@OGNL@isNotEmpty(model.isRead)">
                IS_READ = #{model.isRead},
            </if>
            <if test="@OGNL@isNotEmpty(model.readUserId)">
                READ_USER_ID = #{model.readUserId},
            </if>
            <if test="@OGNL@isNotEmpty(model.readUserName)">
                READ_USER_NAME = #{model.readUserName},
            </if>
            <if test="@OGNL@isNotEmpty(model.readTime)">
                READ_TIME = #{model.readTime},
            </if>
            <if test="@OGNL@isNotEmpty(model.confirmUserId)">
                CONFIRM_USER_ID = #{model.confirmUserId},
            </if>
            <if test="@OGNL@isNotEmpty(model.confirmUserName)">
                CONFIRM_USER_NAME = #{model.confirmUserName},
            </if>
            <if test="@OGNL@isNotEmpty(model.confirmTime)">
                CONFIRM_TIME = #{model.confirmTime},
            </if>
            <if test="@OGNL@isNotEmpty(model.confirmState)">
                CONFIRM_STATE = #{model.confirmState},
            </if>
            <if test="@OGNL@isNotEmpty(model.orderdetailState)">
                ORDERDETAIL_STATE = #{model.orderdetailState},
            </if>
            <if test="@OGNL@isNotEmpty(model.refuseReason)">
                REFUSE_REASON = #{model.refuseReason},
            </if>
            <if test="@OGNL@isNotEmpty(model.detailDistributeAddress)">
                DETAIL_DISTRIBUTE_ADDRESS = #{model.detailDistributeAddress},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalDistributeCount)">
                TOTAL_DISTRIBUTE_COUNT = #{model.totalDistributeCount},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalDistributeAmount)">
                TOTAL_DISTRIBUTE_AMOUNT = #{model.totalDistributeAmount},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalWarehouseCount)">
                TOTAL_WAREHOUSE_COUNT = #{model.totalWarehouseCount},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalWarehouseAmount)">
                TOTAL_WAREHOUSE_AMOUNT = #{model.totalWarehouseAmount},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalReturnAmount)">
                TOTAL_RETURN_AMOUNT = #{model.totalReturnAmount},
            </if>
            <if test="@OGNL@isNotEmpty(model.totalReturnCount)">
                TOTAL_RETURN_COUNT = #{model.totalReturnCount},
            </if>
            <if test="@OGNL@isNotEmpty(model.isUsing)">
                IS_USING = #{model.isUsing},
            </if>
            <if test="@OGNL@isNotEmpty(model.compRatio)">
                COMP_RATIO = #{model.compRatio},
            </if>
            <if test="@OGNL@isNotEmpty(model.orderCustomInfo)">
                ORDER_CUSTOM_INFO = #{model.orderCustomInfo},
            </if>
            <if test="@OGNL@isNotEmpty(model.addUserId)">
                ADD_USER_ID = #{model.addUserId},
            </if>
            <if test="@OGNL@isNotEmpty(model.addUserName)">
                ADD_USER_NAME = #{model.addUserName},
            </if>
            <if test="@OGNL@isNotEmpty(model.addTime)">
                ADD_TIME = #{model.addTime},
            </if>
            <if test="@OGNL@isNotEmpty(model.lastUpdateUserId)">
                LAST_UPDATE_USER_ID = #{model.lastUpdateUserId},
            </if>
            <if test="@OGNL@isNotEmpty(model.lastUpdateUserName)">
                LAST_UPDATE_USER_NAME = #{model.lastUpdateUserName},
            </if>
            <if test="@OGNL@isNotEmpty(model.lastUpdateTime)">
                LAST_UPDATE_TIME = #{model.lastUpdateTime},
            </if>
        </set>
        <where>
            <if test="@OGNL@isNotEmpty(params.orderdetailId)">
                AND t.ORDERDETAIL_ID = #{params.orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(params.orderId)">
                AND t.ORDER_ID = #{params.orderId}
            </if>
            <if test="@OGNL@isNotEmpty(params.procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{params.procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(params.goodsId)">
                AND t.GOODS_ID = #{params.goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(params.productName)">
                AND t.PRODUCT_NAME = #{params.productName}
            </if>
            <if test="@OGNL@isNotEmpty(params.productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{params.productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(params.productWbName)">
                AND t.PRODUCT_WB_NAME = #{params.productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(params.goodsName)">
                AND t.GOODS_NAME = #{params.goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(params.medicinemodel)">
                AND t.MEDICINEMODEL = #{params.medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(params.outlook)">
                AND t.OUTLOOK = #{params.outlook}
            </if>
            <if test="@OGNL@isNotEmpty(params.factor)">
                AND t.FACTOR = #{params.factor}
            </if>
            <if test="@OGNL@isNotEmpty(params.materialName)">
                AND t.MATERIAL_NAME = #{params.materialName}
            </if>
            <if test="@OGNL@isNotEmpty(params.unit)">
                AND t.UNIT = #{params.unit}
            </if>
            <if test="@OGNL@isNotEmpty(params.companyNameSc)">
                AND t.COMPANY_NAME_SC = #{params.companyNameSc}
            </if>
            <if test="@OGNL@isNotEmpty(params.splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{params.splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(params.trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{params.trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(params.companyIdTb)">
                AND t.COMPANY_ID_TB = #{params.companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(params.companyNameTb)">
                AND t.COMPANY_NAME_TB = #{params.companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(params.middlePack)">
                AND t.MIDDLE_PACK = #{params.middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(params.maxPack)">
                AND t.MAX_PACK = #{params.maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(params.isBaseDrug)">
                AND t.IS_BASE_DRUG = #{params.isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(params.qualityLevel)">
                AND t.QUALITY_LEVEL = #{params.qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(params.purchaseType)">
                AND t.PURCHASE_TYPE = #{params.purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(params.sourceId)">
                AND t.SOURCE_ID = #{params.sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(params.sourceName)">
                AND t.SOURCE_NAME = #{params.sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(params.bidPrice)">
                AND t.BID_PRICE = #{params.bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(params.usingRang)">
                AND t.USING_RANG = #{params.usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(params.hospitalId)">
                AND t.HOSPITAL_ID = #{params.hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(params.hospitalName)">
                AND t.HOSPITAL_NAME = #{params.hospitalName}
            </if>
            <if test="@OGNL@isNotEmpty(params.hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{params.hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(params.hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{params.hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(params.adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{params.adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(params.adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{params.adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(params.adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{params.adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(params.belongOrgName)">
                AND t.BELONG_ORG_NAME = #{params.belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(params.orderType)">
                AND t.ORDER_TYPE = #{params.orderType}
            </if>
            <if test="@OGNL@isNotEmpty(params.orderName)">
                AND t.ORDER_NAME = #{params.orderName}
            </if>
            <if test="@OGNL@isNotEmpty(params.submitTime)">
                AND t.SUBMIT_TIME = #{params.submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(params.filingId)">
                AND t.FILING_ID = #{params.filingId}
            </if>
            <if test="@OGNL@isNotEmpty(params.companyIdPs)">
                AND t.COMPANY_ID_PS = #{params.companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(params.companyNamePs)">
                AND t.COMPANY_NAME_PS = #{params.companyNamePs}
            </if>
            <if test="@OGNL@isNotEmpty(params.purchasePrice)">
                AND t.PURCHASE_PRICE = #{params.purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(params.purchaseCount)">
                AND t.PURCHASE_COUNT = #{params.purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(params.purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{params.purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(params.isRead)">
                AND t.IS_READ = #{params.isRead}
            </if>
            <if test="@OGNL@isNotEmpty(params.readUserId)">
                AND t.READ_USER_ID = #{params.readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(params.readUserName)">
                AND t.READ_USER_NAME = #{params.readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(params.readTime)">
                AND t.READ_TIME = #{params.readTime}
            </if>
            <if test="@OGNL@isNotEmpty(params.confirmUserId)">
                AND t.CONFIRM_USER_ID = #{params.confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(params.confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{params.confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(params.confirmTime)">
                AND t.CONFIRM_TIME = #{params.confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(params.confirmState)">
                AND t.CONFIRM_STATE = #{params.confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(params.orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{params.orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(params.refuseReason)">
                AND t.REFUSE_REASON = #{params.refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(params.detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{params.detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{params.totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{params.totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{params.totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{params.totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{params.totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(params.totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{params.totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(params.isUsing)">
                AND t.IS_USING = #{params.isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(params.compRatio)">
                AND t.COMP_RATIO = #{params.compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(params.orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{params.orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(params.addUserId)">
                AND t.ADD_USER_ID = #{params.addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(params.addUserName)">
                AND t.ADD_USER_NAME = #{params.addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(params.addTime)">
                AND t.ADD_TIME = #{params.addTime}
            </if>
            <if test="@OGNL@isNotEmpty(params.lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{params.lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(params.lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{params.lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(params.lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{params.lastUpdateTime}
            </if>
        </where>
    </update>
    <select id="getAllList" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
        from YIMIAO_ORDERDETAIL t
        <where>
            AND t.COMPANY_ID_TB = #{companyIdTb}
            AND t.CONFIRM_STATE in (0,1,5)
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getOkList" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
         FROM YIMIAO_ORDERDETAIL t
        <where>
            AND t.COMPANY_ID_TB = #{companyIdTb}
            AND t.CONFIRM_STATE in (2,6,7)
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYLAllList" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
         FROM YIMIAO_ORDERDETAIL t
        <where>
            t.CONFIRM_STATE in (1,5) AND t.HOSPITAL_ID = #{hospitalId}
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like  CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like  CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYLOkList" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        <where>
            t.CONFIRM_STATE in (2,6,7)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND  t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND  t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND  t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND ( t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or  t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND  t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND  t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND  t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND  t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND  t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND  t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND  t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND  t.COMP_RATIO &lt; 1 and  t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND  t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND  t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>


    <update id="updateByDetailId" parameterType="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail">
        UPDATE YIMIAO_ORDERDETAIL

        <set>
            TOTAL_WAREHOUSE_COUNT=#{totalWarehouseCount},
            TOTAL_WAREHOUSE_AMOUNT=#{totalWarehouseAmount},
            COMP_RATIO=#{compRatio},
            CONFIRM_STATE=#{confirmState}
        </set>


        WHERE ORDERDETAIL_ID = #{orderdetailId}
    </update>

    <select id="statisticsOne" parameterType="map" resultMap="BaseResultMap">
        select tb1.product_name, tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
        tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
        from (
        select t.product_name, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like  CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        group by t.product_name) tb1 FULL OUTER JOIN
        (
        select c.product_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like  CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        group by c.product_name
        ) tb2
        on tb1.product_name = tb2.product_name
    </select>

    <select id="statisticsTwo" parameterType="map" resultMap="BaseResultMap">
        select tb1.product_name, tb1.outlook, tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne,
        tb1.cratioOne,
        tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
        from (
        select t.product_name, t.outlook, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like  CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY t.product_name, t.outlook) tb1 FULL OUTER JOIN
        (
        select c.product_name, c.outlook,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(outlook)">
                AND c.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY c.product_name, c.outlook
        ) tb2
        on tb1.product_name = tb2.product_name
        and tb1.outlook = tb2.outlook
    </select>

    <select id="statisticsThree" parameterType="map" resultMap="BaseResultMap">
        select tb1.goods_id, tb1.product_name, tb1.outlook, tb1.company_name_sc,
        tb1.purchase_price,tb1.unit, tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne,
        tb1.cratioOne,
        tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
        from (
        select t.goods_id, t.product_name, t.outlook, t.company_name_sc,
        t.purchase_price,t.unit, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.outlook like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY t.goods_id, t.product_name, t.outlook,t.company_name_sc,
        t.purchase_price,t.unit) tb1 FULL OUTER JOIN
        (
        select c.goods_id, c.product_name, c.outlook, c.company_name_sc,
        c.purchase_price,c.unit,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND c.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND c.outlook like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND c.goods_id = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY c.goods_id, c.product_name, c.outlook,c.company_name_sc,
        c.purchase_price,c.unit
        ) tb2
        on tb1.goods_id = tb2.goods_id and tb1.product_name = tb2.product_name and
        tb1.outlook = tb2.outlook and tb1.company_name_sc = tb2.company_name_sc and
        tb1.purchase_price = tb2.purchase_price and tb1.unit = tb2.unit
    </select>

    <!--  -->
    <select id="getExportExcelDataCG" parameterType="map" resultType="hashmap">
        select t.PRODUCT_NAME "",
        t.GOODS_NAME "",
        concat(case when t.OUTLOOK is null then "" else t.OUTLOOK end,' (',case when t.MEDICINEMODEL is null then "" else t.MEDICINEMODEL end,')') "",
        t.goods_id "",
        t.UNIT "",
        t.order_name "",
        concat(case when t.COMPANY_NAME_SC is null then "" else t.COMPANY_NAME_SC end,' (',case when t.COMPANY_NAME_TB is null then "" else t.COMPANY_NAME_TB end,')') "",
        t.HOSPITAL_NAME "",
        t.SUBMIT_TIME "",
        t.COMPANY_NAME_PS "",
        t.PURCHASE_PRICE "",
        t.PURCHASE_COUNT "",
        t.PURCHASE_AMOUNT "",
        t.CONFIRM_STATE "",
        t.REFUSE_REASON "",
        t.TOTAL_WAREHOUSE_COUNT "",
        t.TOTAL_WAREHOUSE_AMOUNT "",
        t.COMP_RATIO*100 "%",
        t.ORDER_CUSTOM_INFO "" from (
        SELECT * FROM YIMIAO_ORDERDETAIL m
        <where>
            m.CONFIRM_STATE IN (2, 6, 7)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND m.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND m.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND m.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND m.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>
        ) t
        order by t.SUBMIT_TIME desc
    </select>

    <!--  -->
    <select id="getExportExcelDataNCG" parameterType="map" resultType="hashmap">
        select t.PRODUCT_NAME "",
        t.GOODS_NAME "",
        concat(case when t.OUTLOOK is null then "" else t.OUTLOOK end,' (',case when t.MEDICINEMODEL is null then "" else t.MEDICINEMODEL end,')') "",
        t.UNIT "",
        t.goods_id "",
        concat(case when t.COMPANY_NAME_SC is null then "" else t.COMPANY_NAME_SC end,' (',case when t.COMPANY_NAME_TB is null then "" else t.COMPANY_NAME_TB end,')') "",
        t.HOSPITAL_NAME "",
        t.SUBMIT_TIME "",
        t.ORDER_NAME "",
        t.COMPANY_NAME_PS "",
        t.PURCHASE_PRICE "",
        t.PURCHASE_COUNT "",
        t.PURCHASE_AMOUNT "",
        t.CONFIRM_STATE "",
        t.REFUSE_REASON "",
        t.TOTAL_WAREHOUSE_COUNT "",
        t.TOTAL_WAREHOUSE_AMOUNT "",
        t.COMP_RATIO*100 "%",
        t.ORDER_CUSTOM_INFO "" from (
        SELECT m.* FROM YIMIAO_ORDERDETAIL m
        <where>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND m.CONFIRM_STATE IN (1, 5) AND m.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND m.CONFIRM_STATE IN (0, 1, 5) AND m.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND m.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND m.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>

        ) t
        order by t.SUBMIT_TIME desc
    </select>

    <!--  -->
    <select id="getExportExcelDataWSJ" parameterType="map" resultType="hashmap">
        SELECT t.SUBMIT_TIME "",
        t.HOSPITAL_NAME "",
        t.ORDER_NAME "",
        concat(case when t.OUTLOOK is null then "" else t.OUTLOOK end,' (',case when t.MEDICINEMODEL is null then "" else t.MEDICINEMODEL end,')') "",
        t.goods_id "",
        t.PRODUCT_NAME "",
        t.PURCHASE_PRICE "",
        t.PURCHASE_COUNT "",
        t.PURCHASE_AMOUNT "",
        t.COMPANY_NAME_PS "",
        t.REFUSE_REASON "",
        concat(case when t.COMPANY_NAME_SC is null then "" else t.COMPANY_NAME_SC end,' (',case when t.COMPANY_NAME_TB is null then "" else t.COMPANY_NAME_TB end,')') "",
        t.ORDER_CUSTOM_INFO "",
        t.UNIT "",
        t.CONFIRM_STATE "",
        t.TOTAL_WAREHOUSE_COUNT "",
        t.COMP_RATIO*100 "%",
        t.TOTAL_WAREHOUSE_AMOUNT ""
        FROM YIMIAO_ORDERDETAIL t
        left join std_hospital d on d.hospital_id=t.hospital_id
        <where>
            <if test="@OGNL@isNotEmpty(orderdetailId)">
                AND t.ORDERDETAIL_ID = #{orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>

            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="ratio == 0">
                AND (t.COMP_RATIO <![CDATA[<]]> 1 or t.COMP_RATIO is null)
            </if>
            <if test="ratio == 1">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>
    <!--  -->
    <select id="getExportExcelDataPS" parameterType="map" resultType="hashmap">
        select t.PRODUCT_NAME "",
        t.OUTLOOK "",
        t.UNIT "",
        t.goods_id "",
        t.COMPANY_NAME_SC "",
        t.HOSPITAL_NAME "",
        t.SUBMIT_TIME "",
        t.ORDER_NAME "",
        t.COMPANY_NAME_PS "",
        t.PURCHASE_PRICE "",
        t.PURCHASE_COUNT "",
        t.PURCHASE_AMOUNT "",
        t.CONFIRM_STATE "",
        t.REFUSE_REASON "",
        t.TOTAL_WAREHOUSE_COUNT "",
        t.TOTAL_WAREHOUSE_AMOUNT "",
        t.COMP_RATIO*100 "(%)",
        t.ORDER_CUSTOM_INFO "" FROM YIMIAO_ORDERDETAIL t
        left join std_hospital d on d.hospital_id=t.hospital_id
        <where>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND d.AREA_ID like CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailId)">
                AND t.ORDERDETAIL_ID = #{orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>

            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>

            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="ratio == 0">
                AND (t.COMP_RATIO <![CDATA[<]]> 1 or t.COMP_RATIO is null)
            </if>
            <if test="ratio == 1">
                AND t.COMP_RATIO = 1
            </if>

            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>


    <!--  -->
    <select id="getExportExcelDataPSRET" parameterType="map" resultType="hashmap">
        select t.PRODUCT_NAME "",
        t.OUTLOOK "",
        t.UNIT "",
        t.COMPANY_NAME_SC "",
        t.HOSPITAL_NAME "",
        t.SUBMIT_TIME "",
        t.ORDER_NAME "",
        t.COMPANY_NAME_PS "",
        t.PURCHASE_PRICE "",
        t.PURCHASE_COUNT "",
        t.PURCHASE_AMOUNT "",
        t.CONFIRM_STATE "",
        t.REFUSE_REASON "",
        t.TOTAL_WAREHOUSE_COUNT "",
        t.TOTAL_WAREHOUSE_AMOUNT "",
        t.COMP_RATIO*100 "%",
        t.ORDER_CUSTOM_INFO "" FROM YIMIAO_ORDERDETAIL_RET t
        left join std_hospital d on d.hospital_id=t.hospital_id
        <where>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND d.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailRetId)">
                AND t.ORDERDETAIL_RET_ID = #{orderdetailRetId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.outlook like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.product_name like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>

            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>

            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>


            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>

            <if test="ratio == 0">
                AND (t.COMP_RATIO <![CDATA[<]]> 1 or t.COMP_RATIO is null)
            </if>
            <if test="ratio == 1">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>


            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <!--  -->
    <select id="getExportExcelDataMLTJ" parameterType="map" resultType="hashmap">
        select tb1.product_name "",
        tb1.purchaseCount "", tb1.purchaseAmount "",
        tb1.wcountOne "", tb1.wamountOne "", tb1.cratioOne "%",
        tb2.wcountTwo "", tb2.wamountTwo "", tb2.retArrCount "",
        tb2.retArrAmount "", tb2.cratioTwo "%"
        from (
        select t.product_name, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like  CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        group by t.product_name) tb1 FULL OUTER JOIN
        (
        select c.product_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        group by c.product_name
        ) tb2
        on tb1.product_name = tb2.product_name
    </select>

    <select id="getExportExcelDataMLTJTwo" parameterType="map" resultType="hashmap">
        select tb1.product_name "", tb1.outlook "",
        tb1.purchaseCount "", tb1.purchaseAmount "",
        tb1.wcountOne "", tb1.wamountOne "", tb1.cratioOne "%",
        tb2.wcountTwo "", tb2.wamountTwo "", tb2.retArrCount "",
        tb2.retArrAmount "", tb2.cratioTwo "%"
        from (
        select t.product_name, t.outlook, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like  CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY t.product_name, t.outlook) tb1 FULL OUTER JOIN
        (
        select c.product_name, c.outlook,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(outlook)">
                AND c.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY c.product_name, c.outlook
        ) tb2
        on tb1.product_name = tb2.product_name
        and tb1.outlook = tb2.outlook
    </select>

    <select id="getExportExcelDataMLTJThree" parameterType="map" resultType="hashmap">
        select tb1.goods_id "", tb1.product_name "", tb1.outlook "",
        tb1.company_name_sc "", tb1.purchase_price "",tb1.unit "",
        tb1.purchaseCount "", tb1.purchaseAmount "",
        tb1.wcountOne "", tb1.wamountOne "", tb1.cratioOne "%",
        tb2.wcountTwo "", tb2.wamountTwo "", tb2.retArrCount "",
        tb2.retArrAmount "", tb2.cratioTwo "%"
        from (
        select t.goods_id, t.product_name, t.outlook, t.company_name_sc,
        t.purchase_price,t.unit, sum(t.purchase_count) purchaseCount,
        sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount)
        wamountOne,
        avg(t.comp_ratio) cratioOne
        from yimiao_orderdetail t,std_hospital s
        <where>
            t.hospital_id = s.hospital_id(+) and t.IS_USING = 1
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.outlook like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY t.goods_id, t.product_name, t.outlook,t.company_name_sc,
        t.purchase_price,t.unit) tb1 FULL OUTER JOIN
        (
        select c.goods_id, c.product_name, c.outlook, c.company_name_sc,
        c.purchase_price,c.unit,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo,
        sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
        avg(c.comp_ratio) cratioTwo
        from yimiao_orderdetail_ret c,std_hospital s
        <where>
            c.hospital_id = s.hospital_id(+) and c.IS_USING = 1
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND c.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND c.outlook like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND c.goods_id = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
        </where>
        GROUP BY c.goods_id, c.product_name, c.outlook,c.company_name_sc,
        c.purchase_price,c.unit
        ) tb2
        on tb1.goods_id = tb2.goods_id and tb1.product_name = tb2.product_name and
        tb1.outlook = tb2.outlook and tb1.company_name_sc = tb2.company_name_sc and
        tb1.purchase_price = tb2.purchase_price and tb1.unit = tb2.unit
    </select>

    <select id="getCountOkList" parameterType="map" resultType="hashmap">
        select sum(t.PURCHASE_COUNT) "purchaseCount",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_COUNT) "totalwarehouseCount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio"
        FROM YIMIAO_ORDERDETAIL t
        <where>
            AND t.COMPANY_ID_TB = #{companyIdTb}
            AND t.CONFIRM_STATE in (2,6,7)
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')

            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getAllCountList" parameterType="map" resultType="hashmap">
        select sum(t.PURCHASE_COUNT) "purchaseCount",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_COUNT) "totalwarehouseCount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio"
        from YIMIAO_ORDERDETAIL t
        <where>
            AND t.COMPANY_ID_TB = #{companyIdTb}
            AND t.CONFIRM_STATE in (0,1,5)
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="findCountList" parameterType="map" resultType="hashmap">
        SELECT sum(t.PURCHASE_COUNT) "count1",
        sum(t.PURCHASE_AMOUNT) "amount1",
        sum(t.TOTAL_WAREHOUSE_COUNT) "count2",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "amount2",
        avg(t.COMP_RATIO*100) "radio"
        FROM YIMIAO_ORDERDETAIL t
        left join std_hospital d on d.hospital_id=t.hospital_id
        <where>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND d.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailId)">
                AND t.ORDERDETAIL_ID = #{orderdetailId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND t.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productSpelName)">
                AND t.PRODUCT_SPEL_NAME = #{productSpelName}
            </if>
            <if test="@OGNL@isNotEmpty(productWbName)">
                AND t.PRODUCT_WB_NAME = #{productWbName}
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME = #{goodsName}
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND t.MEDICINEMODEL = #{medicinemodel}
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(factor)">
                AND t.FACTOR = #{factor}
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND t.MATERIAL_NAME = #{materialName}
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND t.UNIT = #{unit}
            </if>

            <if test="@OGNL@isNotEmpty(splitCompanyName)">
                AND t.SPLIT_COMPANY_NAME = #{splitCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(trustCompanyName)">
                AND t.TRUST_COMPANY_NAME = #{trustCompanyName}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameTb)">
                AND t.COMPANY_NAME_TB = #{companyNameTb}
            </if>
            <if test="@OGNL@isNotEmpty(middlePack)">
                AND t.MIDDLE_PACK = #{middlePack}
            </if>
            <if test="@OGNL@isNotEmpty(maxPack)">
                AND t.MAX_PACK = #{maxPack}
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND t.IS_BASE_DRUG = #{isBaseDrug}
            </if>
            <if test="@OGNL@isNotEmpty(qualityLevel)">
                AND t.QUALITY_LEVEL = #{qualityLevel}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseType)">
                AND t.PURCHASE_TYPE = #{purchaseType}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND t.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(sourceName)">
                AND t.SOURCE_NAME = #{sourceName}
            </if>
            <if test="@OGNL@isNotEmpty(bidPrice)">
                AND t.BID_PRICE = #{bidPrice}
            </if>
            <if test="@OGNL@isNotEmpty(usingRang)">
                AND t.USING_RANG = #{usingRang}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>

            <if test="@OGNL@isNotEmpty(hospitalDepartmentId)">
                AND t.HOSPITAL_DEPARTMENT_ID = #{hospitalDepartmentId}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalDepartmentName)">
                AND t.HOSPITAL_DEPARTMENT_NAME = #{hospitalDepartmentName}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdStatisticsDrug)">
                AND t.ADMIN_AREA_ID_STATISTICS_DRUG = #{adminAreaIdStatisticsDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaNameDrug)">
                AND t.ADMIN_AREA_NAME_DRUG = #{adminAreaNameDrug}
            </if>
            <if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
                AND t.ADMIN_AREA_ID_DRUG = #{adminAreaIdDrug}
            </if>
            <if test="@OGNL@isNotEmpty(belongOrgName)">
                AND t.BELONG_ORG_NAME = #{belongOrgName}
            </if>
            <if test="@OGNL@isNotEmpty(orderType)">
                AND t.ORDER_TYPE = #{orderType}
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME = #{orderName}
            </if>
            <if test="@OGNL@isNotEmpty(submitTime)">
                AND t.SUBMIT_TIME = #{submitTime}
            </if>
            <if test="@OGNL@isNotEmpty(filingId)">
                AND t.FILING_ID = #{filingId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND t.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="ratio == 0">
                AND (t.COMP_RATIO <![CDATA[<]]> 1 or t.COMP_RATIO is null)
            </if>
            <if test="ratio == 1">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(purchasePrice)">
                AND t.PURCHASE_PRICE = #{purchasePrice}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseCount)">
                AND t.PURCHASE_COUNT = #{purchaseCount}
            </if>
            <if test="@OGNL@isNotEmpty(purchaseAmount)">
                AND t.PURCHASE_AMOUNT = #{purchaseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(isRead)">
                AND t.IS_READ = #{isRead}
            </if>
            <if test="@OGNL@isNotEmpty(readUserId)">
                AND t.READ_USER_ID = #{readUserId}
            </if>
            <if test="@OGNL@isNotEmpty(readUserName)">
                AND t.READ_USER_NAME = #{readUserName}
            </if>
            <if test="@OGNL@isNotEmpty(readTime)">
                AND t.READ_TIME = #{readTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserId)">
                AND t.CONFIRM_USER_ID = #{confirmUserId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmUserName)">
                AND t.CONFIRM_USER_NAME = #{confirmUserName}
            </if>
            <if test="@OGNL@isNotEmpty(confirmTime)">
                AND t.CONFIRM_TIME = #{confirmTime}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(orderdetailState)">
                AND t.ORDERDETAIL_STATE = #{orderdetailState}
            </if>
            <if test="@OGNL@isNotEmpty(refuseReason)">
                AND t.REFUSE_REASON = #{refuseReason}
            </if>
            <if test="@OGNL@isNotEmpty(detailDistributeAddress)">
                AND t.DETAIL_DISTRIBUTE_ADDRESS = #{detailDistributeAddress}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeCount)">
                AND t.TOTAL_DISTRIBUTE_COUNT = #{totalDistributeCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalDistributeAmount)">
                AND t.TOTAL_DISTRIBUTE_AMOUNT = #{totalDistributeAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseCount)">
                AND t.TOTAL_WAREHOUSE_COUNT = #{totalWarehouseCount}
            </if>
            <if test="@OGNL@isNotEmpty(totalWarehouseAmount)">
                AND t.TOTAL_WAREHOUSE_AMOUNT = #{totalWarehouseAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnAmount)">
                AND t.TOTAL_RETURN_AMOUNT = #{totalReturnAmount}
            </if>
            <if test="@OGNL@isNotEmpty(totalReturnCount)">
                AND t.TOTAL_RETURN_COUNT = #{totalReturnCount}
            </if>
            <if test="@OGNL@isNotEmpty(isUsing)">
                AND t.IS_USING = #{isUsing}
            </if>
            <if test="@OGNL@isNotEmpty(compRatio)">
                AND t.COMP_RATIO = #{compRatio}
            </if>
            <if test="@OGNL@isNotEmpty(orderCustomInfo)">
                AND t.ORDER_CUSTOM_INFO = #{orderCustomInfo}
            </if>
            <if test="@OGNL@isNotEmpty(addUserId)">
                AND t.ADD_USER_ID = #{addUserId}
            </if>
            <if test="@OGNL@isNotEmpty(addUserName)">
                AND t.ADD_USER_NAME = #{addUserName}
            </if>
            <if test="@OGNL@isNotEmpty(addTime)">
                AND t.ADD_TIME = #{addTime}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserId)">
                AND t.LAST_UPDATE_USER_ID = #{lastUpdateUserId}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateUserName)">
                AND t.LAST_UPDATE_USER_NAME = #{lastUpdateUserName}
            </if>
            <if test="@OGNL@isNotEmpty(lastUpdateTime)">
                AND t.LAST_UPDATE_TIME = #{lastUpdateTime}
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYLAllCountList" parameterType="map" resultType="hashmap">
        select sum(t.PURCHASE_COUNT) "purchaseCount",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_COUNT) "totalWarehouseCount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalWarehouseAmount",
        avg(t.COMP_RATIO) "compRatio"
        FROM YIMIAO_ORDERDETAIL t
        <where>
            t.CONFIRM_STATE in (1,5) AND t.HOSPITAL_ID = #{hospitalId}
            <if test="@OGNL@isNotEmpty(orderId)">
                AND t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 andt.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYLOkCountList" parameterType="map" resultType="hashmap">
        select sum(t.PURCHASE_COUNT) "purchaseCount",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_COUNT) "totalWarehouseCount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalWarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio"
        FROM YIMIAO_ORDERDETAIL t
        <where>
            t.CONFIRM_STATE in (2,6,7) AND t.HOSPITAL_ID = #{hospitalId}
            <if test="@OGNL@isNotEmpty(orderId)">
                AND  t.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND  t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND  t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND ( t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or  t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND  t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND  t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND  t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND  t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND  t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND  t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND  t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND  t.COMP_RATIO &lt; 1 and  t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND  t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND  t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getByOrderId" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        left join std_hospital d on d.hospital_id=t.hospital_id
        where order_Id=#{orderId}
    </select>

    <select id="getSupHosp" parameterType="map" resultMap="BaseResultMap">
        select
        <if test="@OGNL@isNotEmpty(hosp)">
            t.hospital_id,
            t.hospital_name,
            s.area_id,
            s.area_name,
        </if>
        <if test="@OGNL@isNotEmpty(company)">
            t.hospital_id,
            t.hospital_name,
            t.company_id_ps,
            t.company_name_ps,
            s.area_id,
            s.area_name,
        </if>
		<if test="@OGNL@isNotEmpty(companySc)">
			t.COMPANY_NAME_SC,
			T.COMPANY_ID_SC,
			s.area_id,
			s.area_name,
		</if>
        <if test="@OGNL@isNotEmpty(goods)">
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,
            s.area_id,
            s.area_name,
        </if>
        <if test="@OGNL@isNotEmpty(order)">
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.company_id_ps,
            t.company_name_ps,
            t.PURCHASE_PRICE,
            t.company_id_sc,
            t.company_name_sc,
            s.area_id,
            s.area_name,
        </if>
		<if test="@OGNL@isNotEmpty(orderD)">
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.company_id_ps,
            t.company_name_ps,
            t.PURCHASE_PRICE,
            t.company_id_sc,
            t.company_name_sc,
            s.area_id,
            s.area_name,
		t.submit_time,
		t.order_name,
		t.confirm_state,

		</if>
        nvl(sum(t.purchase_count), 0) purchaseCount,
        nvl(sum(t.purchase_amount), 0) purchaseAmount,
        nvl(sum(t.total_warehouse_count), 0) wcountOne,
        nvl(sum(t.total_warehouse_amount), 0) wamountOne,
        nvl(avg(t.comp_ratio), 0) cratioOne,
        nvl(sum(c.purchase_count), 0) wcountTwo,
        nvl(sum(c.purchase_amount), 0) wamountTwo,
        nvl(sum(c.total_return_count), 0) retArrCount,
        nvl(sum(c.total_return_amount), 0) retArrAmount,
        nvl(avg(c.comp_ratio), 0) cratioTwo,
        nvl(sum(d.cancle_amount), 0) cancleAmount
        from yimiao_orderdetail t
        left join std_hospital s
        on t.hospital_id = s.hospital_id
        left join yimiao_orderdetail_ret c
        on c.procurecatalog_id=t.procurecatalog_id  and c.hospital_id=t.hospital_id
        left join (select sum(t.purchase_amount) cancle_amount,
        t.orderdetail_id,
        t.hospital_id
        from yimiao_orderdetail t
        where t.confirm_state = 2
        group by t.hospital_id, t.orderdetail_id) d
        on d.hospital_id = t.hospital_id
        and t.orderdetail_id = d.orderdetail_id
        left join yimiao_purchase_order k
        on k.order_id=t.order_id

        <where>
            k.order_state=1
            <if test="@OGNL@isNotEmpty(areaIds)">
                AND s.AREA_ID like CONCAT(#{areaIds}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND (T.MEDICINEMODEL LIKE CONCAT(CONCAT('%', #{medicinemodel}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND (T.OUTLOOK LIKE CONCAT(CONCAT('%', #{outlook}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND (T.MATERIAL_NAME LIKE CONCAT(CONCAT('%', #{materialName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND (T.UNIT LIKE CONCAT(CONCAT('%', #{unit}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND T.IS_BASE_DRUG = #{isBaseDrug}
            </if>

            <if test="@OGNL@isNotEmpty(productName)">
                AND T.PRODUCT_NAME = #{productName}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND T.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeBefore)">
                AND T.SUBMIT_TIME &gt;= DATE_FORMAT(CONCAT(#{submitTimeBefore}, ' 00:00:00'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeAfter)">
                AND T.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND T.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND T.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdSc)">
                AND T.COMPANY_ID_SC = #{companyIdSc}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND T.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND T.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
        </where>
        group by
        <if test="@OGNL@isNotEmpty(hosp)">
            t.hospital_id,
            t.hospital_name,

        </if>
        <if test="@OGNL@isNotEmpty(company)">
            t.hospital_id,
            t.hospital_name,
            t.company_id_ps,
            t.company_name_ps,

        </if>
		<if test="@OGNL@isNotEmpty(companySc)">
			t.COMPANY_NAME_SC,
			T.COMPANY_ID_SC,
			s.area_id,
			s.area_name,
		</if>
        <if test="@OGNL@isNotEmpty(goods)">
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,

        </if>
        <if test="@OGNL@isNotEmpty(order)">
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,
            t.company_id_ps,
            t.company_name_ps,

        </if>
		<if test="@OGNL@isNotEmpty(orderD)">
			t.submit_time,
			t.order_name,
			t.confirm_state,
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.company_id_ps,
            t.company_name_ps,
            t.PURCHASE_PRICE,
            t.company_id_sc,
            t.company_name_sc,
		</if>
        s.area_id,
        s.area_name
        ORDER BY ${sortColumn} ${sortMode}
    </select>
    <select id="getHospDayCount" parameterType="map" resultType="java.util.Map">
        select
        nvl(sum(t.purchase_count), 0) purchaseCount,
        nvl(sum(t.purchase_amount), 0) purchaseAmount,
        nvl(sum(t.total_warehouse_count), 0) wcountOne,
        nvl(sum(t.total_warehouse_amount), 0) wamountOne,
        nvl(avg(t.comp_ratio), 0) cratioOne,
        nvl(sum(c.purchase_count), 0) wcountTwo,
        nvl(sum(c.purchase_amount), 0) wamountTwo,
        nvl(sum(c.total_return_count), 0) retArrCount,
        nvl(sum(c.total_return_amount), 0) retArrAmount,
        nvl(avg(c.comp_ratio), 0) cratioTwo,
        nvl(sum(d.cancle_amount), 0) cancleAmount
        from yimiao_orderdetail t
        left join std_hospital s
        on t.hospital_id = s.hospital_id
        left join yimiao_orderdetail_ret c
        on c.procurecatalog_id=t.procurecatalog_id  and c.hospital_id=t.hospital_id
        left join (select sum(t.purchase_amount) cancle_amount, t.hospital_id
        from yimiao_orderdetail t
        where t.confirm_state = 2
        group by t.hospital_id) d
        on d.hospital_id = t.hospital_id
        left join yimiao_purchase_order k
        on k.order_id=t.order_id

        <where>
            k.order_state=1
            <if test="@OGNL@isNotEmpty(areaIds)">
                AND s.AREA_ID like CONCAT(#{areaIds}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like  CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT( #{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND (T.MEDICINEMODEL LIKE CONCAT(CONCAT('%', #{medicinemodel}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND (T.OUTLOOK LIKE CONCAT(CONCAT('%', #{outlook}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND (T.MATERIAL_NAME LIKE CONCAT(CONCAT('%', #{materialName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND (T.UNIT LIKE CONCAT(CONCAT('%', #{unit}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND T.IS_BASE_DRUG = #{isBaseDrug}
            </if>

            <if test="@OGNL@isNotEmpty(productName)">
                AND T.PRODUCT_NAME = #{productName}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND T.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeBefore)">
                AND T.SUBMIT_TIME &gt;= DATE_FORMAT(CONCAT(#{submitTimeBefore}, ' 00:00:00'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeAfter)">
                AND T.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND T.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND T.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdSc)">
                AND T.COMPANY_ID_SC = #{companyIdSc}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND T.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND T.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
        </where>


    </select>
    <select id="exportAllSup" parameterType="map" resultType="hashmap">
            select
        <if test="@OGNL@isNotEmpty(hosp)">
            t.hospital_id,
            t.hospital_name "" ,
            s.area_id,
            s.area_name "",
        </if>
        <if test="@OGNL@isNotEmpty(company)">
            t.company_id_ps,
            t.company_name_ps "",
            s.area_id,
            s.area_name "",
        </if>
        <if test="@OGNL@isNotEmpty(companySc)">
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            s.area_id,
            s.area_name,
        </if>
              <if test="@OGNL@isNotEmpty(goods)">
            t.procurecatalog_id,
            t.product_name "",
            t.MEDICINEMODEL "",
            t.OUTLOOK "",
            t.MATERIAL_NAME "",
            t.UNIT "",
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC "",
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE "()",
            s.area_id,
            s.area_name "",
        </if>
        <if test="@OGNL@isNotEmpty(order)">
            t.hospital_id,
            t.hospital_name "" ,
            t.procurecatalog_id,
            t.product_name "",
            t.MEDICINEMODEL "",
            t.OUTLOOK "",
            t.MATERIAL_NAME "",
            t.UNIT "",
            t.IS_BASE_DRUG,
            t.company_id_ps,
            t.company_name_ps "",
            t.PURCHASE_PRICE "()",
            t.company_id_sc,
            t.company_name_sc "",
            s.area_id,
            s.area_name "",
        </if>
        <if test="@OGNL@isNotEmpty(orderD)">
            t.submit_time "",
            t.order_name "",
            case t.confirm_state
            when 0 then
            ''
            when 1 then
            ''
            when 2 then
            ''
            else
            null
            end "",
            t.hospital_id,
            t.hospital_name "" ,
            t.procurecatalog_id,
            t.product_name "",
            t.MEDICINEMODEL "",
            t.OUTLOOK "",
            t.MATERIAL_NAME "",
            t.UNIT "",
            t.IS_BASE_DRUG,
            t.company_id_ps,
            t.company_name_ps "",
            t.PURCHASE_PRICE "()",
            t.company_id_sc,
            t.company_name_sc "",
            s.area_id,
            s.area_name "",
        </if>

        nvl(sum(t.purchase_count), 0) "",
        nvl(sum(t.purchase_amount), 0) "()",
        nvl(sum(t.total_warehouse_count), 0) "",
        nvl(sum(t.total_warehouse_amount), 0) "()",
        round(nvl(avg(t.comp_ratio), 0),2)  "",
        nvl(sum(c.purchase_count), 0) wcountTwo,
        nvl(sum(c.purchase_amount), 0) wamountTwo,
        nvl(sum(c.total_return_count), 0)  "",
        nvl(sum(c.total_return_amount), 0)  "()",
        round(nvl(avg(c.comp_ratio), 0),2)  "",
        nvl(sum(d.cancle_amount), 0)  "()"
        from yimiao_orderdetail t
        left join std_hospital s
        on t.hospital_id = s.hospital_id
        left join yimiao_orderdetail_ret c
        on c.procurecatalog_id=t.procurecatalog_id  and c.hospital_id=t.hospital_id
        left join (select sum(t.purchase_amount) cancle_amount, t.hospital_id
        from yimiao_orderdetail t
        where t.confirm_state = 2
        group by t.hospital_id) d
        on d.hospital_id = t.hospital_id
        left join yimiao_purchase_order k
        on k.order_id=t.order_id

        <where>
            k.order_state=1
            <if test="@OGNL@isNotEmpty(areaIds)">
                AND s.AREA_ID like CONCAT(#{areaIds}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND c.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(areaId)">
                AND s.AREA_ID like CONCAT(#{areaId}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(medicinemodel)">
                AND (T.MEDICINEMODEL LIKE CONCAT(CONCAT('%', #{medicinemodel}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND (T.OUTLOOK LIKE CONCAT(CONCAT('%', #{outlook}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(materialName)">
                AND (T.MATERIAL_NAME LIKE CONCAT(CONCAT('%', #{materialName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(unit)">
                AND (T.UNIT LIKE CONCAT(CONCAT('%', #{unit}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(isBaseDrug)">
                AND T.IS_BASE_DRUG = #{isBaseDrug}
            </if>

            <if test="@OGNL@isNotEmpty(productName)">
                AND T.PRODUCT_NAME = #{productName}
            </if>
            <if test="@OGNL@isNotEmpty(sourceId)">
                AND T.SOURCE_ID = #{sourceId}
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeBefore)">
                AND T.SUBMIT_TIME &gt;= DATE_FORMAT(CONCAT(#{submitTimeBefore}, ' 00:00:00'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(submitTimeAfter)">
                AND T.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(companyIdPs)">
                AND T.COMPANY_ID_PS = #{companyIdPs}
            </if>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND T.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdSc)">
                AND T.COMPANY_ID_SC = #{companyIdSc}
            </if>
            <if test="@OGNL@isNotEmpty(procurecatalogId)">
                AND T.PROCURECATALOG_ID = #{procurecatalogId}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND T.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
        </where>
        group by
        <if test="@OGNL@isNotEmpty(hosp)">
            t.hospital_id,
            t.hospital_name,

        </if>
        <if test="@OGNL@isNotEmpty(company)">
            t.company_id_ps,
            t.company_name_ps,
            s.area_id,
            s.area_name,
        </if>
        <if test="@OGNL@isNotEmpty(companySc)">
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,

        </if>
        <if test="@OGNL@isNotEmpty(goods)">
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,

        </if>
        <if test="@OGNL@isNotEmpty(order)">
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,
            t.company_id_ps,
            t.company_name_ps,

        </if>
        <if test="@OGNL@isNotEmpty(orderD)">
            t.submit_time,
            t.order_name,
            t.confirm_state,
            t.hospital_id,
            t.hospital_name,
            t.procurecatalog_id,
            t.product_name,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.MATERIAL_NAME,
            t.UNIT,
            t.IS_BASE_DRUG,
            t.COMPANY_NAME_SC,
            T.COMPANY_ID_SC,
            t.PURCHASE_PRICE,
            t.company_id_ps,
            t.company_name_ps,

        </if>
        s.area_id,
        s.area_name
        ORDER BY ${sortColumn} ${sortMode}
    </select>
	<!--  -->
	<select id="getCompanyScStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
		(case when tb1.company_id_sc is null then tb2.company_id_sc else tb1.company_id_sc end) company_id_sc,
		(case when tb1.company_name_sc is null then tb2.company_name_sc else tb1.company_name_sc end) company_name_sc,
		tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
		tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select t.company_id_sc,t.company_name_sc, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.company_id_sc,t.company_name_sc) tb1
		FULL OUTER JOIN	(
		select c.company_id_sc,c.company_name_sc,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.company_id_sc,c.company_name_sc) tb2
		ON tb1.company_id_sc = tb2.company_id_sc
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataCompanySc" parameterType="map" resultType="hashmap">
		select
		(case when tb1.company_name_sc is null then tb2.company_name_sc else tb1.company_name_sc end) "",
		tb1.purchaseCount "", tb1.purchaseAmount "",
		tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
		tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select t.company_name_sc, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.company_name_sc) tb1 FULL OUTER JOIN
		(
		select c.company_name_sc,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like  CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.company_name_sc) tb2
		on tb1.company_name_sc = tb2.company_name_sc
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoCompanyScCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>
	<!--  -->
	<select id="getCompanyPsStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
		(case when tb1.company_id_ps is null then tb2.company_id_ps else tb1.company_id_ps end) company_id_ps,
		(case when tb1.company_name_ps is null then tb2.company_name_ps else tb1.company_name_ps end) company_name_ps,
		tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
		tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select t.company_id_ps,t.company_name_ps, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.company_id_ps,t.company_name_ps) tb1
		FULL OUTER JOIN	(
		select c.company_id_ps,c.company_name_ps,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.company_id_ps,c.company_name_ps) tb2
		ON tb1.company_id_ps = tb2.company_id_ps
		ORDER BY ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataCompanyPs" parameterType="map" resultType="hashmap">
		select
		(case when tb1.company_name_ps is null then tb2.company_name_ps else tb1.company_name_ps end) "",
		tb1.purchaseCount "", tb1.purchaseAmount "",
		tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
		tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select t.company_name_ps, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.company_name_ps) tb1 FULL OUTER JOIN
		(
		select c.company_name_ps,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.company_name_ps) tb2
		on tb1.company_name_ps = tb2.company_name_ps
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoCompanyPsCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND  to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>
	<!--  -->
	<select id="getAdminAreaStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
		(case when tb1.area_id is null then tb2.area_id else tb1.area_id end) area_id,
		(case when tb1.area_name is null then tb2.area_name else tb1.area_name end) area_name,
		tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
		tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select s.area_id,s.area_name, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by s.area_id,s.area_name) tb1
		FULL OUTER JOIN	(
		select s.area_id,s.area_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by s.area_id,s.area_name) tb2
		ON tb1.area_id = tb2.area_id
		ORDER BY ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataAdminArea" parameterType="map" resultType="hashmap">
		select
		(case when tb1.area_name is null then tb2.area_name else tb1.area_name end) "",
		tb1.purchaseCount "", tb1.purchaseAmount "",
		tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
		tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select s.area_name, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by s.area_name) tb1 FULL OUTER JOIN
		(
		select s.area_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by s.area_name) tb2
		on tb1.area_name = tb2.area_name
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoAdminAreaCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>
	<!--  -->
	<select id="getHospitalMonthStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
		(case when tb1.submitMonth is null then tb2.submitMonth else tb1.submitMonth end) submitMonth,
		tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
		tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select to_char(t.submit_time,'%Y-%m-%d') submitMonth, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by to_char(t.submit_time,'%Y-%m-%d')) tb1
		FULL OUTER JOIN	(
		select to_char(c.submit_time,'%Y-%m-%d') submitMonth,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by to_char(c.submit_time,'%Y-%m-%d')) tb2
		ON tb1.submitMonth = tb2.submitMonth
		ORDER BY ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataHospitalMonth" parameterType="map" resultType="hashmap">
		select
		(case when tb1.submitMonth is null then tb2.submitMonth else tb1.submitMonth end) "",
		tb1.purchaseCount "", tb1.purchaseAmount "",
		tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
		tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select to_char(t.submit_time,'%Y-%m-%d') submitMonth, sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like  CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by to_char(t.submit_time,'%Y-%m-%d')) tb1 FULL OUTER JOIN
		(
		select to_char(c.submit_time,'%Y-%m-%d') submitMonth,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by to_char(c.submit_time,'%Y-%m-%d')) tb2
		on tb1.submitMonth = tb2.submitMonth
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoHospitalMonthCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>
	<!--  -->
	<select id="getHospitalStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
			(case when tb1.hospital_id is null then tb2.hospital_id else tb1.hospital_id end) hospital_id,
			(case when tb1.hospital_name is null then tb2.hospital_name else tb1.hospital_name end) hospital_name,
			(case when tb1.area_name is null then tb2.area_name else tb1.area_name end) area_name,
			tb1.purchaseCount, tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
			tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select t.hospital_id,t.hospital_name,s.area_name,sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like  CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.hospital_id,t.hospital_name,s.area_name) tb1
		FULL OUTER JOIN	(
		select c.hospital_id,c.hospital_name,s.area_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.hospital_id,c.hospital_name,s.area_name) tb2
		ON tb1.hospital_id = tb2.hospital_id
		ORDER BY ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataHospital" parameterType="map" resultType="hashmap">
		select
			(case when tb1.hospital_name is null then tb2.hospital_name else tb1.hospital_name end) "",
			(case when tb1.area_name is null then tb2.area_name else tb1.area_name end) "",
			tb1.purchaseCount "", tb1.purchaseAmount "",
			tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
			tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select t.hospital_name, s.area_name,sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.hospital_name, s.area_name) tb1 FULL OUTER JOIN
		(
		select c.hospital_name, s.area_name,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.hospital_name,s.area_name) tb2
		on tb1.hospital_name = tb2.hospital_name
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoHospitalCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>

	<!--  -->
	<select id="getYimiaoProcurecatalogStatistics" parameterType="map" resultMap="BaseResultMap">
		SELECT
			(case when tb1.procurecatalog_id is null then tb2.procurecatalog_id else tb1.procurecatalog_id end) procurecatalog_id,
			(case when tb1.product_name is null then tb2.product_name else tb1.product_name end) product_name,
			(case when tb1.outlook is null then tb2.outlook else tb1.outlook end) outlook,
			(case when tb1.unit is null then tb2.unit else tb1.unit end) unit,
			tb1.purchaseCount,tb1.purchaseAmount, tb1.wcountOne, tb1.wamountOne, tb1.cratioOne,
			tb2.wcountTwo, tb2.wamountTwo, tb2.retArrCount, tb2.retArrAmount, tb2.cratioTwo
		FROM (
		select t.procurecatalog_id,t.product_name,t.outlook,t.unit,sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.procurecatalog_id,t.product_name,t.outlook,t.unit) tb1
		FULL OUTER JOIN	(
		select c.procurecatalog_id,c.product_name,c.outlook,c.unit,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.procurecatalog_id,c.product_name,c.outlook,c.unit) tb2
		ON tb1.procurecatalog_id = tb2.procurecatalog_id
		ORDER BY ${sortColumn} ${sortMode}
	</select>

	<select id="exportDataYimiaoProcurecatalog" parameterType="map" resultType="hashmap">
		select
			(case when tb1.procurecatalog_id is null then tb2.procurecatalog_id else tb1.procurecatalog_id end) "",
			(case when tb1.product_name is null then tb2.product_name else tb1.product_name end) "",
			(case when tb1.outlook is null then tb2.outlook else tb1.outlook end) "",
			(case when tb1.unit is null then tb2.unit else tb1.unit end) "",
			tb1.purchaseCount "", tb1.purchaseAmount "",
			tb1.wcountOne "", tb1.wamountOne "", ROUND(tb1.cratioOne,4)*100 "%",
			tb2.wcountTwo "", tb2.wamountTwo "", ROUND(tb2.cratioTwo,4)*100 "%"
		from (
		select t.procurecatalog_id,t.product_name,t.outlook,t.unit,sum(t.purchase_count) purchaseCount,
		sum(t.purchase_amount) purchaseAmount, sum(t.total_warehouse_count) wcountOne, sum(t.total_warehouse_amount) wamountOne,
		avg(t.comp_ratio) cratioOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by t.procurecatalog_id,t.product_name,t.outlook,t.unit) tb1 FULL OUTER JOIN
		(
		select c.procurecatalog_id,c.product_name,c.outlook,c.unit,sum(c.purchase_count) wcountTwo, sum(c.purchase_amount) wamountTwo, sum(c.total_return_count) retArrCount, sum(c.total_return_amount) retArrAmount,
		avg(c.comp_ratio) cratioTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>
		group by c.procurecatalog_id,c.product_name,c.outlook,c.unit) tb2
		on tb1.procurecatalog_id = tb2.procurecatalog_id
		order by ${sortColumn} ${sortMode}
	</select>

	<select id="getYimiaoProcurecatalogCount" parameterType="map" resultType="java.util.Map">
		SELECT tb1.purchaseAmount,tb1.wamountOne,tb2.wamountTwo
		FROM (
		select sum(t.purchase_amount) purchaseAmount,sum(t.total_warehouse_amount) wamountOne
		from yimiao_orderdetail t,std_hospital s
		<where>
			t.hospital_id = s.hospital_id(+) and t.IS_USING = 1 and t.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND t.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND t.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND t.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND t.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND t.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(t.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT( #{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb1
		CROSS JOIN	(
		select sum(c.purchase_amount) wamountTwo
		from yimiao_orderdetail_ret c,std_hospital s
		<where>
			c.hospital_id = s.hospital_id(+) and c.IS_USING = 1 and c.confirm_state = 1
			<if test="@OGNL@isNotEmpty(companyNamePs)">
				AND c.company_name_ps like CONCAT(CONCAT('%', #{companyNamePs}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(companyNameSc)">
				AND c.company_name_Sc like CONCAT(CONCAT('%', #{companyNameSc}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(hospitalName)">
				AND c.hospital_name like CONCAT(CONCAT('%', #{hospitalName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(procurecatalogId)">
				AND c.procurecatalog_Id = #{procurecatalogId}
			</if>
			<if test="@OGNL@isNotEmpty(productName)">
				AND c.product_Name like CONCAT(CONCAT('%', #{productName}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitMonth)">
				AND to_char(c.submit_time,'%Y-%m-%d') = #{submitMonth}
			</if>
			<if test="@OGNL@isNotEmpty(adminAreaIdDrug)">
				AND s.AREA_ID like CONCAT(#{adminAreaIdDrug}), '%')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeBefore)">
				AND c.SUBMIT_TIME &gt;= DATE_FORMAT(#{submitTimeBefore},'%Y-%m-%d %H:%i:%S')
			</if>
			<if test="@OGNL@isNotEmpty(submitTimeAfter)">
				AND c.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{submitTimeAfter}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
			</if>
		</where>) tb2
	</select>

    <select id="getYimiaoData" parameterType="map" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        <where>
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND (t.CONFIRM_STATE IN (0,3,4) OR t.CONFIRM_STATE IS NULL) AND t.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.CONFIRM_STATE = 0 AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(center)">
                AND (t.CONFIRM_STATE IN (0,3,4) OR t.CONFIRM_STATE IS NULL)
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT('%', #{outlook}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT('%', #{companyNameSc}, '%')
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYLOkListByHospitalId" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
         FROM YIMIAO_ORDERDETAIL t
        <where>
            AND t.CONFIRM_STATE in (5,6)
            AND t.HOSPITAL_ID = #{hospitalId}
            AND t.TOTAL_WAREHOUSE_COUNT > t.TOTAL_RETURN_COUNT
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND t.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND t.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND t.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND t.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND t.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND t.COMP_RATIO &lt; 1 and t.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND t.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psng)">
                AND t.COMP_RATIO = 0
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYimiaoOrderdetailByProcurecatalogId" parameterType="map" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        WHERE t.ORDER_ID = #{orderId} AND t.PROCURECATALOG_ID = #{procurecatalogId}
    </select>


    <select id="queryYimiaoOrderDetailNotret" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="full-columns"/>
        from (
        SELECT * FROM YIMIAO_ORDERDETAIL m
        <where>
            m.goods_id not in
            (SELECT goods_id
            FROM YIMIAO_ORDERDETAIL_RET
            where  ORDER_ID = #{orderId}
            ) AND
            m.CONFIRM_STATE = 2
            <!--AND m.COMP_RATIO = 1-->
            AND m.HOSPITAL_ID = #{hospitalId} AND m.TOTAL_WAREHOUSE_COUNT > 0 AND m.IS_USING = 1
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>
        <!--union all-->
        <!--SELECT * FROM YIMIAO_ORDERDETAIL m-->
        <!--<where>-->
            <!--m.CONFIRM_STATE = 2 AND m.HOSPITAL_ID = #{hospitalId} AND m.IS_USING = 1-->
            <!--<if test="@OGNL@isNotEmpty(goodsId)">-->
                <!--AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(orderName)">-->
                <!--AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(outlook)">-->
                <!--AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(productName)">-->
                <!--AND (m.PRODUCT_NAME like  CONCAT(CONCAT('%', #{productName}), '%')-->
                <!--or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(hospitalName)">-->
                <!--AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(companyNameSc)">-->
                <!--AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(companyNamePs)">-->
                <!--AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(confirmState)">-->
                <!--AND m.CONFIRM_STATE = #{confirmState}-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(startTime)">-->
                <!--AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(endTime)">-->
                <!--AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(bufen)">-->
                <!--AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(wancheng)">-->
                <!--AND m.COMP_RATIO = 1-->
            <!--</if>-->
            <!--<if test="@OGNL@isNotEmpty(Psing)">-->
                <!--AND m.COMP_RATIO = 0-->
            <!--</if>-->
        <!--</where>-->
        ) t
        order by t.SUBMIT_TIME desc
    </select>

    <update id="updateCancelOrderDetailStatus">
        UPDATE
        yimiao_orderdetail m
        <set>
            m.CONFIRM_STATE = 7,m.SUBMIT_TIME = NOW()
        </set>
        <where>
            CONFIRM_STATE IN (0, 1, 3, 4) OR CONFIRM_STATE IS NULL
        </where>
    </update>

    <update id="updateCancelOrderStatus">
        UPDATE
        yimiao_purchase_order y
        <set>
            y.ORDER_STATE = 6,y.SUBMIT_TIME = NOW()
        </set>
        <where>
            y.ORDER_ID IN (
            SELECT m.ORDER_ID FROM yimiao_orderdetail m
            <where>
                m. CONFIRM_STATE IN (0, 1, 3, 4) OR m.CONFIRM_STATE IS NULL
            </where>
            GROUP BY m.ORDER_ID
            ) OR y.ORDER_STATE = 0
        </where>
    </update>

    <update id="updatetoOrderDetailStatus">
        UPDATE
        yimiao_orderdetail m
        <set>
            m.CONFIRM_STATE = 6,m.SUBMIT_TIME = NOW()
        </set>
        <where>
            m.CONFIRM_STATE = 5
        </where>
    </update>

    <update id="updateOrderStatus">
        UPDATE
        yimiao_purchase_order y
        <set>
            y.ORDER_STATE = 5,y.SUBMIT_TIME = NOW()
        </set>
        <where>
            y.ORDER_ID IN (
            SELECT ORDER_ID FROM(
            SELECT m.ORDER_ID ORDER_ID FROM yimiao_orderdetail m
            <where>
                m. CONFIRM_STATE = 5
            </where>
            UNION
            SELECT b.ORDER_ID ORDER_ID FROM yimiao_orderdetail b
            INNER JOIN yimiao_purchase_order t ON t.ORDER_ID = b.ORDER_ID
            <where>
                b. CONFIRM_STATE = 2 AND t.ORDER_STATE = 6
            </where>
            ) a
            )
        </where>
    </update>

    <select id="toCheckOrderCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM yimiao_purchase_order t where t.HOSPITAL_ID= #{hospitalId}
        and date_format(t.ADD_TIME,'%Y-%m')=date_format(now(),'%Y-%m') and ORDER_STATE NOT IN (0,3,6)
    </select>

    <select id="toCheckOrderCreateCount" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM yimiao_purchase_order t where t.HOSPITAL_ID= #{hospitalId}
        and ORDER_STATE IN (0,3)
    </select>

    <update id="updateOrderDetailStatus">
        UPDATE YIMIAO_ORDERDETAIL
        <set>
            CONFIRM_STATE = #{confirmState},
            SUBMIT_TIME=now()
        </set>
        WHERE CONFIRM_STATE = 3 and ORDER_ID in
        <foreach collection="list" item="item" open="(" separator=" , " close=")">
            #{item.orderId}
        </foreach>

    </update>


    <insert id="addProtoList" parameterType="java.util.List">
        INSERT INTO YIMIAO_ORDERDETAIL(
        ORDERDETAIL_ID,
        ORDER_ID ,
        PROCURECATALOG_ID ,
        GOODS_ID ,
        PRODUCT_NAME ,
        PRODUCT_SPEL_NAME ,
        PRODUCT_WB_NAME ,
        GOODS_NAME ,
        MEDICINEMODEL ,
        OUTLOOK ,
        FACTOR ,
        MATERIAL_NAME ,
        UNIT ,
        COMPANY_ID_SC ,
        COMPANY_NAME_SC ,
        SPLIT_COMPANY_NAME ,
        TRUST_COMPANY_NAME ,
        COMPANY_ID_TB ,
        COMPANY_NAME_TB ,
        MIDDLE_PACK ,
        MAX_PACK ,
        IS_BASE_DRUG ,
        QUALITY_LEVEL ,
        PURCHASE_TYPE ,
        SOURCE_ID ,
        SOURCE_NAME ,
        BID_PRICE ,
        USING_RANG ,
        HOSPITAL_ID ,
        HOSPITAL_NAME ,
        HOSPITAL_DEPARTMENT_ID ,
        HOSPITAL_DEPARTMENT_NAME ,
        ADMIN_AREA_ID_STATISTICS_DRUG ,
        ADMIN_AREA_NAME_DRUG ,
        ADMIN_AREA_ID_DRUG ,
        BELONG_ORG_NAME ,
        ORDER_TYPE ,
        ORDER_NAME ,
        SUBMIT_TIME ,
        FILING_ID ,
        COMPANY_ID_PS ,
        COMPANY_NAME_PS ,
        PURCHASE_PRICE ,
        PURCHASE_COUNT ,
        PURCHASE_AMOUNT ,
        IS_READ ,
        READ_USER_ID ,
        READ_USER_NAME ,
        READ_TIME ,
        CONFIRM_USER_ID ,
        CONFIRM_USER_NAME ,
        CONFIRM_TIME ,
        CONFIRM_STATE ,
        ORDERDETAIL_STATE ,
        REFUSE_REASON ,
        DETAIL_DISTRIBUTE_ADDRESS ,
        TOTAL_DISTRIBUTE_COUNT ,
        TOTAL_DISTRIBUTE_AMOUNT ,
        TOTAL_WAREHOUSE_COUNT ,
        TOTAL_WAREHOUSE_AMOUNT ,
        TOTAL_RETURN_AMOUNT ,
        TOTAL_RETURN_COUNT ,
        IS_USING ,
        COMP_RATIO ,
        ORDER_CUSTOM_INFO ,
        ADD_USER_ID ,
        ADD_USER_NAME ,
        ADD_TIME ,
        LAST_UPDATE_USER_ID ,
        LAST_UPDATE_USER_NAME ,
        LAST_UPDATE_TIME,
        WT_COMPANY_NAME_PS
        )
        <foreach collection="list" item="item" index="index" separator="union all">
            SELECT
            #{item.orderdetailId},
            #{item.orderId},
            #{item.procurecatalogId},
            #{item.goodsId},
            #{item.productName},
            #{item.productSpelName},
            #{item.productWbName},
            #{item.goodsName},
            #{item.medicinemodel},
            #{item.outlook},
            #{item.factor},
            #{item.materialName},
            #{item.unit},
            #{item.companyIdSc},
            #{item.companyNameSc},
            #{item.splitCompanyName},
            #{item.trustCompanyName},
            #{item.companyIdTb},
            #{item.companyNameTb},
            #{item.middlePack},
            #{item.maxPack},
            #{item.isBaseDrug},
            #{item.qualityLevel},
            #{item.purchaseType},
            #{item.sourceId},
            #{item.sourceName},
            #{item.bidPrice},
            #{item.usingRang},
            #{item.hospitalId},
            #{item.hospitalName},
            #{item.hospitalDepartmentId},
            #{item.hospitalDepartmentName},
            #{item.adminAreaIdStatisticsDrug},
            #{item.adminAreaNameDrug},
            #{item.adminAreaIdDrug},
            #{item.belongOrgName},
            #{item.orderType},
            #{item.orderName},
            #{item.submitTime},
            #{item.filingId},
            #{item.companyIdPs},
            #{item.companyNamePs},
            #{item.purchasePrice},
            #{item.purchaseCount},
            #{item.purchaseAmount},
            #{item.isRead},
            #{item.readUserId},
            #{item.readUserName},
            #{item.readTime},
            #{item.confirmUserId},
            #{item.confirmUserName},
            #{item.confirmTime},
            #{item.confirmState},
            #{item.orderdetailState},
            #{item.refuseReason},
            #{item.detailDistributeAddress},
            #{item.totalDistributeCount},
            #{item.totalDistributeAmount},
            #{item.totalWarehouseCount},
            #{item.totalWarehouseAmount},
            #{item.totalReturnAmount},
            #{item.totalReturnCount},
            #{item.isUsing},
            #{item.compRatio},
            #{item.orderCustomInfo},
            #{item.addUserId},
            #{item.addUserName},
            #{item.addTime},
            #{item.lastUpdateUserId},
            #{item.lastUpdateUserName},
            #{item.lastUpdateTime},
            #{item.wtCompanyNamePs}
        </foreach>
    </insert>

    <select id="getOrderDetailByOrderId" parameterType="com.hsnn.medstgmini.yimiao.model.YimiaoOrderdetail" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        where t.ORDER_ID = #{orderId}
    </select>

    <update id="updateByData" parameterType="map">
        UPDATE YIMIAO_ORDERDETAIL a
        INNER JOIN (
            <foreach collection="list" item="val" index="index" separator=" UNION ALL ">
                select
                #{val.yimiaoOrderdetailId}  ORDERDETAIL_ID,
                #{val.returnReason} RETURN_REASON,
                #{val.lastPurchaseCount} TOTAL_RETURN_COUNT
            </foreach>
          ) b ON  a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
        SET a.TOTAL_RETURN_COUNT = a.TOTAL_RETURN_COUNT+b.TOTAL_RETURN_COUNT,
        a.TOTAL_RETURN_AMOUNT = a.PURCHASE_PRICE*b.TOTAL_RETURN_COUNT + a.TOTAL_RETURN_AMOUNT,
        a.RETURN_REASON = b.RETURN_REASON

    </update>


    <update id="updateByDataForDel" parameterType="map">
        UPDATE yimiao_orderdetail a
        INNER JOIN (
        SELECT ORDERDETAIL_ID,sum(TOTAL_RETURN_COUNT) TOTAL_RETURN_COUNT
        from yimiao_orderdetail_ret
        where ORDERDETAIL_RET_ID in
        <foreach collection="list" item="var"  index="index" open="(" separator="," close=")">
        #{var.orderdetailRetId}
        </foreach>
        GROUP BY ORDERDETAIL_ID
        ) b on a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
        SET a.TOTAL_RETURN_COUNT = a.TOTAL_RETURN_COUNT - b.TOTAL_RETURN_COUNT,
        a.TOTAL_RETURN_AMOUNT =a.TOTAL_RETURN_AMOUNT - (a.PURCHASE_PRICE*b.TOTAL_RETURN_COUNT)

    </update>

    <update id="updateByDataForEdit" parameterType="map">
        UPDATE yimiao_orderdetail a
        INNER JOIN (
        SELECT ORDERDETAIL_ID,sum(TOTAL_RETURN_COUNT) TOTAL_RETURN_COUNT
        from yimiao_orderdetail_ret
        where ORDERDETAIL_ID in
        <foreach collection="list" item="var"  index="index" open="(" separator="," close=")">
            #{var.orderDetailId}
        </foreach>
        GROUP BY ORDERDETAIL_ID
        ) b on a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
        SET a.TOTAL_RETURN_COUNT = b.TOTAL_RETURN_COUNT,
        a.TOTAL_RETURN_AMOUNT =a.PURCHASE_PRICE*b.TOTAL_RETURN_COUNT

    </update>

    <select id="getYimiaoPsData" parameterType="map" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        <where>
            AND t.CONFIRM_STATE IN (1,5)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND t.OUTLOOK like CONCAT('%', #{outlook}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT('%', #{companyNameSc}, '%')
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getYimiaoRkData" parameterType="map" resultMap="BaseResultMap">
        SELECT
        <include refid="full-columns"/>
        FROM YIMIAO_ORDERDETAIL t
        <where>
            AND t.CONFIRM_STATE IN (2,5,6)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND t.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND t.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND t.GOODS_ID = #{goodsId}
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (t.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or t.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND t.COMPANY_NAME_PS like CONCAT('%', #{companyNamePs}, '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND t.COMPANY_NAME_SC like CONCAT('%', #{companyNameSc}, '%')
            </if>
        </where>
        order by t.SUBMIT_TIME desc
    </select>

    <select id="getExportExcelCatalog" parameterType="map" resultType="hashmap">
        SELECT
        m.GOODS_ID '',
        m.GOODS_NAME '',
        m.PRODUCT_NAME '',
        m.UNIT '',
        concat(case when m.OUTLOOK is null then "" else m.OUTLOOK end,' (',case when m.MEDICINEMODEL is null then "" else m.MEDICINEMODEL end,')') "",
        concat(case when m.COMPANY_NAME_SC is null then "" else m.COMPANY_NAME_SC end,' (',case when m.COMPANY_NAME_TB is null then "" else m.COMPANY_NAME_TB end,')') "",
        m.HOSPITAL_NAME '',
        m.ORDER_NAME '',
        m.COMPANY_NAME_PS '',
        m.PURCHASE_PRICE '',
        m.PURCHASE_COUNT '',
        m.PURCHASE_AMOUNT '',
        m.TOTAL_WAREHOUSE_COUNT '',
        m.TOTAL_WAREHOUSE_AMOUNT '',
        m.COMP_RATIO '%',
        m.SUBMIT_TIME
        FROM
        YIMIAO_ORDERDETAIL m
        <where>
            m.CONFIRM_STATE IN (2, 5, 6)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND m.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND m.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND m.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>
        order by m.SUBMIT_TIME desc
    </select>

    <select id="getExportExcelDispatch" parameterType="map" resultType="hashmap">
        SELECT
        m.GOODS_ID '',
        m.GOODS_NAME '',
        m.PRODUCT_NAME '',
        m.UNIT '',
        concat(case when m.OUTLOOK is null then "" else m.OUTLOOK end,' (',case when m.MEDICINEMODEL is null then "" else m.MEDICINEMODEL end,')') "",
        concat(case when m.COMPANY_NAME_SC is null then "" else m.COMPANY_NAME_SC end,' (',case when m.COMPANY_NAME_TB is null then "" else m.COMPANY_NAME_TB end,')') "",
        m.HOSPITAL_NAME '',
        m.ORDER_NAME '',
        m.PURCHASE_PRICE '',
        m.PURCHASE_COUNT '',
        m.PURCHASE_AMOUNT '',
        m.ORDER_CUSTOM_INFO ''
        FROM
        YIMIAO_ORDERDETAIL m
        <where>
            m.CONFIRM_STATE IN (1, 5)
            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND m.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND m.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND m.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>
        order by m.SUBMIT_TIME desc
    </select>

    <select id="getExportExcelPurchase" parameterType="map" resultType="hashmap">
        SELECT
        m.GOODS_ID '',
        m.GOODS_NAME '',
        m.PRODUCT_NAME '',
        m.UNIT '',
        concat(case when m.OUTLOOK is null then "" else m.OUTLOOK end,' (',case when m.MEDICINEMODEL is null then "" else m.MEDICINEMODEL end,')') "",
        concat(case when m.COMPANY_NAME_SC is null then "" else m.COMPANY_NAME_SC end,' (',case when m.COMPANY_NAME_TB is null then "" else m.COMPANY_NAME_TB end,')') "",
        m.HOSPITAL_NAME '',
        m.ORDER_NAME '',
        m.PURCHASE_PRICE '',
        m.PURCHASE_COUNT '',
        m.PURCHASE_AMOUNT '',
        m.ORDER_CUSTOM_INFO ''
        FROM
        YIMIAO_ORDERDETAIL m
        <where>
            (
            m.CONFIRM_STATE IN (0, 3, 4)
            OR m.CONFIRM_STATE IS NULL
            )

            <if test="@OGNL@isNotEmpty(hospitalId)">
                AND m.HOSPITAL_ID = #{hospitalId}
            </if>
            <if test="@OGNL@isNotEmpty(companyIdTb)">
                AND m.COMPANY_ID_TB = #{companyIdTb}
            </if>
            <if test="@OGNL@isNotEmpty(orderId)">
                AND m.ORDER_ID = #{orderId}
            </if>
            <if test="@OGNL@isNotEmpty(goodsId)">
                AND m.goods_id like CONCAT(CONCAT('%', #{goodsId}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(orderName)">
                AND m.ORDER_NAME like CONCAT(CONCAT('%', #{orderName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(productName)">
                AND (m.PRODUCT_NAME like CONCAT(CONCAT('%', #{productName}), '%')
                or m.PRODUCT_SPEL_NAME like CONCAT(CONCAT('%', #{productName}), '%'))
            </if>
            <if test="@OGNL@isNotEmpty(goodsName)">
                AND t.GOODS_NAME like CONCAT(CONCAT('%', #{goodsName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(hospitalName)">
                AND m.HOSPITAL_NAME like CONCAT(CONCAT('%', #{hospitalName}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(outlook)">
                AND m.OUTLOOK like CONCAT(CONCAT('%', #{outlook}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNameSc)">
                AND m.COMPANY_NAME_SC like CONCAT(CONCAT('%', #{companyNameSc}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(companyNamePs)">
                AND m.COMPANY_NAME_PS like CONCAT(CONCAT('%', #{companyNamePs}), '%')
            </if>
            <if test="@OGNL@isNotEmpty(confirmState)">
                AND m.CONFIRM_STATE = #{confirmState}
            </if>
            <if test="@OGNL@isNotEmpty(startTime)">
                AND m.SUBMIT_TIME &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(endTime)">
                AND m.SUBMIT_TIME &lt;= DATE_FORMAT(CONCAT(#{endTime}, ' 23:59:59'),'%Y-%m-%d %H:%i:%S')
            </if>
            <if test="@OGNL@isNotEmpty(bufen)">
                AND m.COMP_RATIO &lt; 1 and m.COMP_RATIO &gt; 0
            </if>
            <if test="@OGNL@isNotEmpty(wancheng)">
                AND m.COMP_RATIO = 1
            </if>
            <if test="@OGNL@isNotEmpty(Psing)">
                AND m.COMP_RATIO = 0
            </if>
        </where>
        order by m.SUBMIT_TIME desc
    </select>

    <insert id="saveByMap" parameterType="java.util.List">
        INSERT INTO YIMIAO_ORDERDETAIL(
        ORDERDETAIL_ID,
        ORDER_ID ,
        PROCURECATALOG_ID ,
        GOODS_ID ,
        PRODUCT_NAME ,
        PRODUCT_SPEL_NAME ,
        PRODUCT_WB_NAME ,
        GOODS_NAME ,
        MEDICINEMODEL ,
        OUTLOOK ,
        FACTOR ,
        MATERIAL_NAME ,
        UNIT ,
        COMPANY_ID_SC ,
        COMPANY_NAME_SC ,
        SPLIT_COMPANY_NAME ,
        TRUST_COMPANY_NAME ,
        COMPANY_ID_TB ,
        COMPANY_NAME_TB ,
        MIDDLE_PACK ,
        MAX_PACK ,
        IS_BASE_DRUG ,
        QUALITY_LEVEL ,
        PURCHASE_TYPE ,
        SOURCE_ID ,
        SOURCE_NAME ,
        BID_PRICE ,
        USING_RANG ,
        HOSPITAL_ID ,
        HOSPITAL_NAME ,
        HOSPITAL_DEPARTMENT_ID ,
        HOSPITAL_DEPARTMENT_NAME ,
        ADMIN_AREA_ID_STATISTICS_DRUG ,
        ADMIN_AREA_NAME_DRUG ,
        ADMIN_AREA_ID_DRUG ,
        BELONG_ORG_NAME ,
        ORDER_TYPE ,
        ORDER_NAME ,
        SUBMIT_TIME ,
        FILING_ID ,
        COMPANY_ID_PS ,
        COMPANY_NAME_PS ,
        PURCHASE_PRICE ,
        PURCHASE_COUNT ,
        PURCHASE_AMOUNT ,
        IS_READ ,
        READ_USER_ID ,
        READ_USER_NAME ,
        READ_TIME ,
        CONFIRM_USER_ID ,
        CONFIRM_USER_NAME ,
        CONFIRM_TIME ,
        CONFIRM_STATE ,
        ORDERDETAIL_STATE ,
        REFUSE_REASON ,
        DETAIL_DISTRIBUTE_ADDRESS ,
        TOTAL_DISTRIBUTE_COUNT ,
        TOTAL_DISTRIBUTE_AMOUNT ,
        TOTAL_WAREHOUSE_COUNT ,
        TOTAL_WAREHOUSE_AMOUNT ,
        TOTAL_RETURN_AMOUNT ,
        TOTAL_RETURN_COUNT ,
        IS_USING ,
        COMP_RATIO ,
        ORDER_CUSTOM_INFO ,
        ADD_USER_ID ,
        ADD_USER_NAME ,
        ADD_TIME ,
        LAST_UPDATE_USER_ID ,
        LAST_UPDATE_USER_NAME ,
        LAST_UPDATE_TIME,
        WT_COMPANY_NAME_PS
        )
        select
        UUID() ORDERDETAIL_ID,
        #{orderId} ORDER_ID ,
        a.PROCURECATALOG_ID ,
        b.GOODS_ID ,
        b.PRODUCT_NAME ,
        b.PRODUCT_SPEL_NAME ,
        b.PRODUCT_WB_NAME ,
        b.GOODS_NAME ,
        b.MEDICINEMODEL ,
        b.OUTLOOK ,
        b.FACTOR ,
        b.MATERIAL_NAME ,
        b.UNIT ,
        b.COMPANY_ID_SC ,
        b.COMPANY_NAME_SC ,
        b.SPLIT_COMPANY_NAME ,
        b.TRUST_COMPANY_NAME ,
        b.COMPANY_ID_TB ,
        b.COMPANY_NAME_TB ,
        b.MIDDLE_PACK ,
        b.MAX_PACK ,
        b.IS_BASE_DRUG ,
        b.QUALITY_LEVEL ,
        b.PURCHASE_TYPE ,
        b.SOURCE_ID ,
        b.SOURCE_NAME ,
        b.BID_PRICE ,
        b.USING_RANG ,
        b.HOSPITAL_ID ,
        b.HOSPITAL_NAME ,
        b.HOSPITAL_DEPARTMENT_ID ,
        b.HOSPITAL_DEPARTMENT_NAME ,
        null ADMIN_AREA_ID_STATISTICS_DRUG ,
        null ADMIN_AREA_NAME_DRUG ,
        null ADMIN_AREA_ID_DRUG ,
        null BELONG_ORG_NAME ,
        null ORDER_TYPE,
        #{orderName} ORDER_NAME ,
        now() SUBMIT_TIME,
        null FILING_ID ,
        null COMPANY_ID_PS ,
        b.COMPANY_NAME_PS ,
        b.BID_PRICE PURCHASE_PRICE ,
        a.PURCHASE_COUNT ,
        a.PURCHASE_AMOUNT ,
        null IS_READ ,
        null READ_USER_ID ,
        null READ_USER_NAME ,
        null READ_TIME ,
        null CONFIRM_USER_ID ,
        null CONFIRM_USER_NAME ,
        null CONFIRM_TIME ,
        null CONFIRM_STATE ,
        null ORDERDETAIL_STATE ,
        null REFUSE_REASON ,
        null DETAIL_DISTRIBUTE_ADDRESS ,
        0 TOTAL_DISTRIBUTE_COUNT,
        0 TOTAL_DISTRIBUTE_AMOUNT,
        0 TOTAL_WAREHOUSE_COUNT,
        0 TOTAL_WAREHOUSE_AMOUNT,
        0 TOTAL_RETURN_AMOUNT,
        0 TOTAL_RETURN_COUNT,
        0 IS_USING,
        0 COMP_RATIO ,
        a.ORDER_CUSTOM_INFO ,
        #{userId} ADD_USER_ID ,
        #{name} ADD_USER_NAME ,
        now() ADD_TIME ,
        #{userId} LAST_UPDATE_USER_ID ,
        #{name} LAST_UPDATE_USER_NAME ,
        now() LAST_UPDATE_TIME,
        b.COMPANY_NAME_PS WT_COMPANY_NAME_PS
        from (
        <foreach collection="list" item="val" index="index" separator="union all">
            SELECT
            #{val.procurecatalogId} PROCURECATALOG_ID,
            #{val.lastPurchaseCount} PURCHASE_COUNT,
            #{val.purchaseAmount} PURCHASE_AMOUNT,
            #{val.remark} ORDER_CUSTOM_INFO
        </foreach>
        ) a
        INNER JOIN yimiao_catalog b on a.PROCURECATALOG_ID = b.PROCURECATALOG_ID and b.HOSPITAL_ID = #{userId}
    </insert>


    <update id="updateByRetOrderIdForDel" parameterType="map">
        UPDATE yimiao_orderdetail a
        INNER JOIN (
        SELECT ORDERDETAIL_ID,sum(TOTAL_RETURN_COUNT) TOTAL_RETURN_COUNT
        from yimiao_orderdetail_ret
        where ORDER_ID in
        <foreach collection="retorderIdList" item="var"  index="index" open="(" separator="," close=")">
            #{var}
        </foreach>
        GROUP BY ORDERDETAIL_ID
        ) b on a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
        SET a.TOTAL_RETURN_COUNT = a.TOTAL_RETURN_COUNT - b.TOTAL_RETURN_COUNT,
        a.TOTAL_RETURN_AMOUNT =a.TOTAL_RETURN_AMOUNT - (a.PURCHASE_PRICE*b.TOTAL_RETURN_COUNT)

    </update>

    <update id="updateByOrderDetailIdForStatus" parameterType="map">
        UPDATE YIMIAO_ORDERDETAIL a
        INNER JOIN (
        <foreach collection="list" item="val" index="index" separator=" UNION ALL ">
            select
            #{val.orderdetailId}  ORDERDETAIL_ID,
            #{val.confirmState} CONFIRM_STATE,
            #{val.refuseReason} REFUSE_REASON,
            #{val.companyNamePs} COMPANY_NAME_PS
        </foreach>
        ) b on a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
        SET
        a.CONFIRM_STATE =  b.CONFIRM_STATE,
        a.REFUSE_REASON =b.REFUSE_REASON,
        a.COMPANY_NAME_PS =b.COMPANY_NAME_PS
    </update>

    <update id="updateByDetailIdForDH" parameterType="map">
    UPDATE YIMIAO_ORDERDETAIL a
    INNER JOIN (
    <foreach collection="list" item="val" index="index" separator=" UNION ALL ">
        select
        #{val.orderdetailId} ORDERDETAIL_ID,
        #{val.warehouseCount} TOTAL_WAREHOUSE_COUNT,
        #{val.totalWarehouseAmount} TOTAL_WAREHOUSE_AMOUNT,
        #{val.compRatio} COMP_RATIO
    </foreach>
    ) b on a.ORDERDETAIL_ID = b.ORDERDETAIL_ID
    SET
    a.TOTAL_WAREHOUSE_COUNT = a.TOTAL_WAREHOUSE_COUNT + b.TOTAL_WAREHOUSE_COUNT,
    a.TOTAL_WAREHOUSE_AMOUNT = a.TOTAL_WAREHOUSE_AMOUNT + b.TOTAL_WAREHOUSE_AMOUNT,
    a.COMP_RATIO = a.COMP_RATIO + b.COMP_RATIO/100,
    a.CONFIRM_STATE = CASE WHEN a.TOTAL_WAREHOUSE_COUNT + b.TOTAL_WAREHOUSE_COUNT = a.PURCHASE_COUNT THEN 6 ELSE 5 END
    where (a.TOTAL_WAREHOUSE_COUNT + b.TOTAL_WAREHOUSE_COUNT) &gt; 0 AND (a.TOTAL_WAREHOUSE_COUNT + b.TOTAL_WAREHOUSE_COUNT) &lt;= a.PURCHASE_COUNT
</update>

    <select id="checkException" statementType="CALLABLE" resultType="java.util.Map">
        CALL checkException(#{out_flag,mode=OUT,jdbcType=VARCHAR})
    </select>

    <select id="toCheckSwitch" resultType="java.lang.Integer">
        SELECT COUNT(ID) FROM std_dict
        WHERE ID = 3356 AND DICTIONARY_VALUE = 'true'
    </select>

    <select id="getDataByAll" parameterType="map" resultMap="BaseResultMap">
        SELECT
          t.ADD_TIME "addTime",
          sum(t.PURCHASE_AMOUNT) "purchaseAmount",
          sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
          avg(t.COMP_RATIO*100) "compRatio"
        FROM YIMIAO_ORDERDETAIL t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        GROUP BY DATE_FORMAT(t.ADD_TIME,'%Y-%m')
        ORDER BY t.ADD_TIME DESC
    </select>

    <select id="getDataByJKCenter" parameterType="map" resultMap="BaseResultMap">
        SELECT
        t.ADD_TIME "addTime",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio",
        t.HOSPITAL_NAME,
        t.HOSPITAL_ID
        FROM YIMIAO_ORDERDETAIL t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        GROUP BY HOSPITAL_ID,DATE_FORMAT(t.ADD_TIME, '%Y-%m')
        ORDER BY t.ADD_TIME DESC
    </select>

    <select id="getDataBySC" parameterType="map" resultMap="BaseResultMap">
        SELECT
        t.ADD_TIME "addTime",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio",
        t.COMPANY_NAME_SC,
        t.COMPANY_ID_SC
        FROM YIMIAO_ORDERDETAIL t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        GROUP BY COMPANY_ID_SC,DATE_FORMAT(t.ADD_TIME, '%Y-%m')
        ORDER BY t.ADD_TIME DESC
    </select>

    <select id="getDataByPS" parameterType="map" resultMap="BaseResultMap">
        SELECT
        t.ADD_TIME "addTime",
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO*100) "compRatio",
        t.COMPANY_NAME_PS
        FROM YIMIAO_ORDERDETAIL t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        GROUP BY COMPANY_NAME_PS,DATE_FORMAT(t.ADD_TIME, '%Y-%m')
        ORDER BY t.ADD_TIME DESC
    </select>

    <select id="getDataBySelf" parameterType="map" resultMap="BaseResultMap">
        SELECT
            t.ADD_TIME,
            sum(t.PURCHASE_AMOUNT) "purchaseAmount",
            sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
            avg(t.COMP_RATIO * 100) "compRatio",
            t.GOODS_NAME,
            t.GOODS_ID,
            t.PRODUCT_NAME,
            t.OUTLOOK,
            t.MEDICINEMODEL,
            t.COMPANY_NAME_SC,
            t.COMPANY_NAME_TB
        FROM
            YIMIAO_ORDERDETAIL t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        GROUP BY
            GOODS_ID,
            DATE_FORMAT(t.ADD_TIME, '%Y-%m')
        ORDER BY
            t.ADD_TIME DESC
    </select>

    <select id="getAnaByAllTz" parameterType="map" resultMap="BaseResultMap">
        SELECT
          sum(t.PURCHASE_AMOUNT) "purchaseAmount",
          sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
          avg(t.COMP_RATIO * 100) "compRatio",
            t.ORDERDETAIL_ID,
            t.ORDER_ID,
            t.PROCURECATALOG_ID,
            t.GOODS_ID,
            t.PRODUCT_NAME,
            t.PRODUCT_SPEL_NAME,
            t.PRODUCT_WB_NAME,
            t.GOODS_NAME,
            t.MEDICINEMODEL,
            t.OUTLOOK,
            t.FACTOR,
            t.MATERIAL_NAME,
            t.UNIT,
            t.COMPANY_ID_SC,
            t.COMPANY_NAME_SC,
            t.SPLIT_COMPANY_NAME,
            t.TRUST_COMPANY_NAME,
            t.COMPANY_ID_TB,
            t.COMPANY_NAME_TB,
            t.MIDDLE_PACK,
            t.MAX_PACK,
            t.IS_BASE_DRUG,
            t.QUALITY_LEVEL,
            t.PURCHASE_TYPE,
            t.SOURCE_ID,
            t.SOURCE_NAME,
            t.BID_PRICE,
            t.USING_RANG,
            t.HOSPITAL_ID,
            t.HOSPITAL_NAME,
            t.HOSPITAL_DEPARTMENT_ID,
            t.HOSPITAL_DEPARTMENT_NAME,
            t.ADMIN_AREA_ID_STATISTICS_DRUG,
            t.ADMIN_AREA_NAME_DRUG,
            t.ADMIN_AREA_ID_DRUG,
            t.BELONG_ORG_NAME,
            t.ORDER_TYPE,
            t.ORDER_NAME,
            t.SUBMIT_TIME,
            t.FILING_ID,
            t.COMPANY_ID_PS,
            t.COMPANY_NAME_PS,
            t.IS_READ,
            t.READ_USER_ID,
            t.READ_USER_NAME,
            t.READ_TIME,
            t.CONFIRM_USER_ID,
            t.CONFIRM_USER_NAME,
            t.CONFIRM_TIME,
            t.CONFIRM_STATE,
            t.ORDERDETAIL_STATE,
            t.REFUSE_REASON,
            t.DETAIL_DISTRIBUTE_ADDRESS,
            t.IS_USING,
            t.ORDER_CUSTOM_INFO,
            t.ADD_USER_ID,
            t.ADD_USER_NAME,
            t.ADD_TIME,
            t.LAST_UPDATE_USER_ID,
            t.LAST_UPDATE_USER_NAME,
            t.LAST_UPDATE_TIME,
            t.WT_COMPANY_NAME_PS,
          s.AREA_NAME "areaName"
        FROM
          yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
          DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        GROUP BY
            <if test="type==1">
                t.HOSPITAL_ID
            </if>
          <if test="type==2">
              t.GOODS_ID
          </if>
        <if test="type==3">
            t.COMPANY_NAME_PS
        </if>
        <if test="type==4">
            t.COMPANY_ID_SC
        </if>
    </select>

    <select id="getAnaHospdruginfoTotal" parameterType="map" resultMap="BaseResultMap">
        SELECT
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO * 100) "compRatio",
        t.ORDERDETAIL_ID,
        t.ORDER_ID,
        t.PROCURECATALOG_ID,
        t.GOODS_ID,
        t.PRODUCT_NAME,
        t.PRODUCT_SPEL_NAME,
        t.PRODUCT_WB_NAME,
        t.GOODS_NAME,
        t.MEDICINEMODEL,
        t.OUTLOOK,
        t.FACTOR,
        t.MATERIAL_NAME,
        t.UNIT,
        t.COMPANY_ID_SC,
        t.COMPANY_NAME_SC,
        t.SPLIT_COMPANY_NAME,
        t.TRUST_COMPANY_NAME,
        t.COMPANY_ID_TB,
        t.COMPANY_NAME_TB,
        t.MIDDLE_PACK,
        t.MAX_PACK,
        t.IS_BASE_DRUG,
        t.QUALITY_LEVEL,
        t.PURCHASE_TYPE,
        t.SOURCE_ID,
        t.SOURCE_NAME,
        t.BID_PRICE,
        t.USING_RANG,
        t.HOSPITAL_ID,
        t.HOSPITAL_NAME,
        t.HOSPITAL_DEPARTMENT_ID,
        t.HOSPITAL_DEPARTMENT_NAME,
        t.ADMIN_AREA_ID_STATISTICS_DRUG,
        t.ADMIN_AREA_NAME_DRUG,
        t.ADMIN_AREA_ID_DRUG,
        t.BELONG_ORG_NAME,
        t.ORDER_TYPE,
        t.ORDER_NAME,
        t.SUBMIT_TIME,
        t.FILING_ID,
        t.COMPANY_ID_PS,
        t.COMPANY_NAME_PS,
        t.IS_READ,
        t.READ_USER_ID,
        t.READ_USER_NAME,
        t.READ_TIME,
        t.CONFIRM_USER_ID,
        t.CONFIRM_USER_NAME,
        t.CONFIRM_TIME,
        t.CONFIRM_STATE,
        t.ORDERDETAIL_STATE,
        t.REFUSE_REASON,
        t.DETAIL_DISTRIBUTE_ADDRESS,
        t.IS_USING,
        t.ORDER_CUSTOM_INFO,
        t.ADD_USER_ID,
        t.ADD_USER_NAME,
        t.ADD_TIME,
        t.LAST_UPDATE_USER_ID,
        t.LAST_UPDATE_USER_NAME,
        t.LAST_UPDATE_TIME,
        t.WT_COMPANY_NAME_PS,
        s.AREA_NAME "areaName"
        FROM
        yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        AND t.HOSPITAL_ID = #{hospCode}
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        GROUP BY
        <if test="type==2">
            t.GOODS_ID
        </if>
        <if test="type==3">
            t.COMPANY_NAME_PS
        </if>
        <if test="type==4">
            t.COMPANY_ID_SC
        </if>
    </select>


    <select id="getAnaByProdcompTz" parameterType="map" resultMap="BaseResultMap">
        SELECT
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO * 100) "compRatio",
        t.ORDERDETAIL_ID,
        t.ORDER_ID,
        t.PROCURECATALOG_ID,
        t.GOODS_ID,
        t.PRODUCT_NAME,
        t.PRODUCT_SPEL_NAME,
        t.PRODUCT_WB_NAME,
        t.GOODS_NAME,
        t.MEDICINEMODEL,
        t.OUTLOOK,
        t.FACTOR,
        t.MATERIAL_NAME,
        t.UNIT,
        t.COMPANY_ID_SC,
        t.COMPANY_NAME_SC,
        t.SPLIT_COMPANY_NAME,
        t.TRUST_COMPANY_NAME,
        t.COMPANY_ID_TB,
        t.COMPANY_NAME_TB,
        t.MIDDLE_PACK,
        t.MAX_PACK,
        t.IS_BASE_DRUG,
        t.QUALITY_LEVEL,
        t.PURCHASE_TYPE,
        t.SOURCE_ID,
        t.SOURCE_NAME,
        t.BID_PRICE,
        t.USING_RANG,
        t.HOSPITAL_ID,
        t.HOSPITAL_NAME,
        t.HOSPITAL_DEPARTMENT_ID,
        t.HOSPITAL_DEPARTMENT_NAME,
        t.ADMIN_AREA_ID_STATISTICS_DRUG,
        t.ADMIN_AREA_NAME_DRUG,
        t.ADMIN_AREA_ID_DRUG,
        t.BELONG_ORG_NAME,
        t.ORDER_TYPE,
        t.ORDER_NAME,
        t.SUBMIT_TIME,
        t.FILING_ID,
        t.COMPANY_ID_PS,
        t.COMPANY_NAME_PS,
        t.IS_READ,
        t.READ_USER_ID,
        t.READ_USER_NAME,
        t.READ_TIME,
        t.CONFIRM_USER_ID,
        t.CONFIRM_USER_NAME,
        t.CONFIRM_TIME,
        t.CONFIRM_STATE,
        t.ORDERDETAIL_STATE,
        t.REFUSE_REASON,
        t.DETAIL_DISTRIBUTE_ADDRESS,
        t.IS_USING,
        t.ORDER_CUSTOM_INFO,
        t.ADD_USER_ID,
        t.ADD_USER_NAME,
        t.ADD_TIME,
        t.LAST_UPDATE_USER_ID,
        t.LAST_UPDATE_USER_NAME,
        t.LAST_UPDATE_TIME,
        t.WT_COMPANY_NAME_PS,
        s.AREA_NAME "areaName"
        FROM
        yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        AND t.COMPANY_ID_SC = #{prodCode}
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        GROUP BY
        <if test="type==1">
            t.HOSPITAL_ID
        </if>
        <if test="type==2">
            t.GOODS_ID
        </if>
        <if test="type==3">
            t.COMPANY_NAME_PS
        </if>
    </select>

    <select id="getAnaDelWithMon" parameterType="map" resultMap="BaseResultMap">
        SELECT
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO * 100) "compRatio",
        t.ORDERDETAIL_ID,
        t.ORDER_ID,
        t.PROCURECATALOG_ID,
        t.GOODS_ID,
        t.PRODUCT_NAME,
        t.PRODUCT_SPEL_NAME,
        t.PRODUCT_WB_NAME,
        t.GOODS_NAME,
        t.MEDICINEMODEL,
        t.OUTLOOK,
        t.FACTOR,
        t.MATERIAL_NAME,
        t.UNIT,
        t.COMPANY_ID_SC,
        t.COMPANY_NAME_SC,
        t.SPLIT_COMPANY_NAME,
        t.TRUST_COMPANY_NAME,
        t.COMPANY_ID_TB,
        t.COMPANY_NAME_TB,
        t.MIDDLE_PACK,
        t.MAX_PACK,
        t.IS_BASE_DRUG,
        t.QUALITY_LEVEL,
        t.PURCHASE_TYPE,
        t.SOURCE_ID,
        t.SOURCE_NAME,
        t.BID_PRICE,
        t.USING_RANG,
        t.HOSPITAL_ID,
        t.HOSPITAL_NAME,
        t.HOSPITAL_DEPARTMENT_ID,
        t.HOSPITAL_DEPARTMENT_NAME,
        t.ADMIN_AREA_ID_STATISTICS_DRUG,
        t.ADMIN_AREA_NAME_DRUG,
        t.ADMIN_AREA_ID_DRUG,
        t.BELONG_ORG_NAME,
        t.ORDER_TYPE,
        t.ORDER_NAME,
        t.SUBMIT_TIME,
        t.FILING_ID,
        t.COMPANY_ID_PS,
        t.COMPANY_NAME_PS,
        t.IS_READ,
        t.READ_USER_ID,
        t.READ_USER_NAME,
        t.READ_TIME,
        t.CONFIRM_USER_ID,
        t.CONFIRM_USER_NAME,
        t.CONFIRM_TIME,
        t.CONFIRM_STATE,
        t.ORDERDETAIL_STATE,
        t.REFUSE_REASON,
        t.DETAIL_DISTRIBUTE_ADDRESS,
        t.IS_USING,
        t.ORDER_CUSTOM_INFO,
        t.ADD_USER_ID,
        t.ADD_USER_NAME,
        t.ADD_TIME,
        t.LAST_UPDATE_USER_ID,
        t.LAST_UPDATE_USER_NAME,
        t.LAST_UPDATE_TIME,
        t.WT_COMPANY_NAME_PS,
        s.AREA_NAME "areaName"
        FROM
        yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        AND t.COMPANY_NAME_PS = #{delCompName}
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        GROUP BY
        <if test="type==1">
            t.HOSPITAL_ID
        </if>
        <if test="type==2">
            t.GOODS_ID
        </if>
        <if test="type==4">
            t.COMPANY_ID_SC
        </if>
    </select>

    <select id="getAnaHospTotalMon" parameterType="map" resultMap="BaseResultMap">
        SELECT
        sum(t.PURCHASE_AMOUNT) "purchaseAmount",
        sum(t.TOTAL_WAREHOUSE_AMOUNT) "totalwarehouseAmount",
        avg(t.COMP_RATIO * 100) "compRatio",
        t.ORDERDETAIL_ID,
        t.ORDER_ID,
        t.PROCURECATALOG_ID,
        t.GOODS_ID,
        t.PRODUCT_NAME,
        t.PRODUCT_SPEL_NAME,
        t.PRODUCT_WB_NAME,
        t.GOODS_NAME,
        t.MEDICINEMODEL,
        t.OUTLOOK,
        t.FACTOR,
        t.MATERIAL_NAME,
        t.UNIT,
        t.COMPANY_ID_SC,
        t.COMPANY_NAME_SC,
        t.SPLIT_COMPANY_NAME,
        t.TRUST_COMPANY_NAME,
        t.COMPANY_ID_TB,
        t.COMPANY_NAME_TB,
        t.MIDDLE_PACK,
        t.MAX_PACK,
        t.IS_BASE_DRUG,
        t.QUALITY_LEVEL,
        t.PURCHASE_TYPE,
        t.SOURCE_ID,
        t.SOURCE_NAME,
        t.BID_PRICE,
        t.USING_RANG,
        t.HOSPITAL_ID,
        t.HOSPITAL_NAME,
        t.HOSPITAL_DEPARTMENT_ID,
        t.HOSPITAL_DEPARTMENT_NAME,
        t.ADMIN_AREA_ID_STATISTICS_DRUG,
        t.ADMIN_AREA_NAME_DRUG,
        t.ADMIN_AREA_ID_DRUG,
        t.BELONG_ORG_NAME,
        t.ORDER_TYPE,
        t.ORDER_NAME,
        t.SUBMIT_TIME,
        t.FILING_ID,
        t.COMPANY_ID_PS,
        t.COMPANY_NAME_PS,
        t.IS_READ,
        t.READ_USER_ID,
        t.READ_USER_NAME,
        t.READ_TIME,
        t.CONFIRM_USER_ID,
        t.CONFIRM_USER_NAME,
        t.CONFIRM_TIME,
        t.CONFIRM_STATE,
        t.ORDERDETAIL_STATE,
        t.REFUSE_REASON,
        t.DETAIL_DISTRIBUTE_ADDRESS,
        t.IS_USING,
        t.ORDER_CUSTOM_INFO,
        t.ADD_USER_ID,
        t.ADD_USER_NAME,
        t.ADD_TIME,
        t.LAST_UPDATE_USER_ID,
        t.LAST_UPDATE_USER_NAME,
        t.LAST_UPDATE_TIME,
        t.WT_COMPANY_NAME_PS,
        s.AREA_NAME "areaName"
        FROM
        yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        AND t.GOODS_ID = #{drugCode}
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        GROUP BY
        <if test="type==1">
            t.HOSPITAL_ID
        </if>
        <if test="type==3">
            t.COMPANY_NAME_PS
        </if>
    </select>

    <select id="getExportExcelDataBy" parameterType="map" resultType="hashmap">
        SELECT
        t.GOODS_ID '',
        t.GOODS_NAME '',
        t.PRODUCT_NAME '',
        t.UNIT '',
        concat(case when t.OUTLOOK is null then "" else t.OUTLOOK end,' (',case when t.MEDICINEMODEL is null then "" else t.MEDICINEMODEL end,')') "",
        concat(case when t.COMPANY_NAME_SC is null then "" else t.COMPANY_NAME_SC end,' (',case when t.COMPANY_NAME_TB is null then "" else t.COMPANY_NAME_TB end,')') "",
        t.HOSPITAL_NAME '',
        t.ORDER_NAME '',
        t.COMPANY_NAME_SC '',
        t.COMPANY_NAME_PS '',
        t.PURCHASE_PRICE '',
        sum(t.PURCHASE_AMOUNT) '()',
        sum(t.TOTAL_WAREHOUSE_AMOUNT) '()',
        FORMAT(avg(t.COMP_RATIO * 100),2) '(%)',
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') ''
        FROM yimiao_orderdetail t
        WHERE 1=1
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        GROUP BY
        DATE_FORMAT(t.ADD_TIME,'%Y-%m'),
        <if test="@OGNL@isNotEmpty(type)">
            <if test="type==1">
                t.HOSPITAL_ID
            </if>
            <if test="type==2">
                t.COMPANY_ID_SC
            </if>
            <if test="type==3">
                t.COMPANY_NAME_PS
            </if>
            <if test="type==4">
                t.GOODS_ID
            </if>
        </if>

        ORDER BY t.ADD_TIME DESC
    </select>

    <select id="exportExcelByAllTz" parameterType="map" resultType="hashmap">
        SELECT
        t.GOODS_ID '',
        t.GOODS_NAME '',
        t.PRODUCT_NAME '',
        t.UNIT '',
        concat(case when t.OUTLOOK is null then "" else t.OUTLOOK end,' (',case when t.MEDICINEMODEL is null then "" else t.MEDICINEMODEL end,')') "",
        concat(case when t.COMPANY_NAME_SC is null then "" else t.COMPANY_NAME_SC end,' (',case when t.COMPANY_NAME_TB is null then "" else t.COMPANY_NAME_TB end,')') "",
        t.HOSPITAL_NAME '',
        t.ORDER_NAME '',
        t.COMPANY_NAME_SC '',
        t.COMPANY_NAME_PS '',
        t.PURCHASE_PRICE '',
        sum(t.PURCHASE_AMOUNT) '()',
        sum(t.TOTAL_WAREHOUSE_AMOUNT) '()',
        FORMAT(avg(t.COMP_RATIO * 100),2) '(%)',
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') '',
        s.AREA_NAME ''
        FROM yimiao_orderdetail t
        LEFT JOIN std_hospital s ON t.HOSPITAL_ID = s.HOSPITAL_ID
        WHERE
        DATE_FORMAT(t.ADD_TIME, '%Y-%m') = #{date}
        <if test="@OGNL@isNotEmpty(hospCode)">
            AND t.HOSPITAL_ID = #{hospCode}
        </if>
        <if test="@OGNL@isNotEmpty(prodCode)">
            AND t.COMPANY_ID_SC = #{prodCode}
        </if>
        <if test="@OGNL@isNotEmpty(drugCode)">
            AND t.GOODS_ID = #{drugCode}
        </if>
        <if test="@OGNL@isNotEmpty(starttime)">
            AND t.ADD_TIME &gt;= #{starttime}
        </if>
        <if test="@OGNL@isNotEmpty(endtime)">
            AND t.ADD_TIME &lt;= #{endtime}
        </if>
        <if test="@OGNL@isNotEmpty(hospName)">
            AND t.HOSPITAL_NAME LIKE CONCAT(CONCAT('%', #{hospName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(prodCompName)">
            AND t.COMPANY_NAME_SC LIKE CONCAT(CONCAT('%', #{prodCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(delCompName)">
            AND t.COMPANY_NAME_PS LIKE CONCAT(CONCAT('%', #{delCompName}), '%')
        </if>
        <if test="@OGNL@isNotEmpty(drugName)">
            AND t.GOODS_NAME LIKE CONCAT(CONCAT('%', #{drugName}), '%')
        </if>
        GROUP BY
        <if test="@OGNL@isNotEmpty(type)">
            <if test="type==1">
                t.HOSPITAL_ID
            </if>
            <if test="type==2">
                t.GOODS_ID
            </if>
            <if test="type==3">
                t.COMPANY_NAME_PS
            </if>
            <if test="type==4">
                t.COMPANY_ID_SC
            </if>


        </if>

        ORDER BY t.ADD_TIME DESC
    </select>
</mapper>
	