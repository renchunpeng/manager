"use strict";if(typeof jQuery==="undefined"){throw new Error("AdminLTE requires jQuery")}$.HN={};$(function(){_initHN();$.HN.layout();$(":input,select",".form-table").each(function(){if($(this).attr("type")!="button"&&$(this).attr("type")!="submit"&&$(this).attr("type")!="reset"&&$(this).attr("type")!="image"&&$(this).attr("disabled")!="disabled"){if($(this).val()==""){$(this).css("background-color","#dbeadd")}else{$(this).attr("data-oldvalue",$(this).val())}$(this).bind("blur",function(){if($(this).val()!=""&&$(this).val()!=$(this).data("oldvalue")){$(this).css("background-color","#dbeadd")}else{if($(this).val()!=""&&$(this).val()==$(this).data("oldvalue")){$(this).css("background-color","#fff")}}})}})});function _initHN(){$.HN={Test:function(){alert("Hello！")},TestObject:{Hello:function(msg){alert(msg)}},layout:function(){$(window,".content").resize(function(){jqgridAutoWH()});$(".height-btn").unbind("click");$(".height-btn").click(function(){var bBody=$(this).parents(".box-header").siblings(".box-body");if(bBody.is(":visible")){$(this).parents(".box-header").siblings(".box-body").hide();$(this).find(".fa").removeClass("fa-minus");$(this).find(".fa").addClass("fa-plus")}else{$(this).parents(".box-header").siblings(".box-body").show();$(this).find(".fa").removeClass("fa-plus");$(this).find(".fa").addClass("fa-minus")}jqgridAutoWH()});if(typeof $.fn.slimScroll!="undefined"){$(".modal-body").slimScroll({alwaysVisible:false,height:"260px",size:"3px"})}},message:{alert:function(message,title,classify,callback){$.alert(message,classify,callback)},confirm:function(message,title,oktext){var modalcontent=$("<div class='modal-content'></div>");var modalheader=$("<div class='modal-header'></div>").append($('<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>'));title=(title==""||title==NaN)?"提示信息":title;oktext=(oktext==""||oktext==NaN)?"确定":oktext;$('<h4 class="modal-title text-info"><i class="fa fa-question-circle"></i>&nbsp;&nbsp;'+title+"</h4>").appendTo(modalheader);modalheader.appendTo(modalcontent);$('<div class="modal-body"> <p>'+message+"</p> </div>").appendTo(modalcontent);var modelfooter=$("<div class='modal-footer'></div>").append($('<button type="button" class="btn btn-primary btn-ok btn-sm" data-dismiss="modal">'+oktext+"</button>")).append($('<button type="button" class="btn btn-default btn-cancel btn-sm" data-dismiss="modal">取消</button>'));modelfooter.appendTo(modalcontent);if(typeof(top.$(".modal.fade.confirm").html())!="undefined"){return{on:function(){}}}var modal=top.$("<div class='modal fade confirm'></div>").append($("<div class='modal-dialog modal-sm'></div>").append(modalcontent));modal.modal({keyboard:true}).on("hidden.bs.modal",function(e){$(this).detach()});return{on:function(callback){if(callback&&callback instanceof Function){modal.find(".btn-ok").one("click",function(){callback(true)});modal.find(".btn-cancel").click(function(){callback(false)})}}}},withoutConfirm:function(message,title,oktext){var modalcontent=$("<div class='modal-content'></div>");var modalheader=$("<div class='modal-header'></div>").append($('<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span></button>'));title=(title==""||title==NaN)?"提示信息":title;oktext=(oktext==""||oktext==NaN)?"确定":oktext;$('<h4 class="modal-title text-info"><i class="fa fa-question-circle"></i>&nbsp;&nbsp;'+title+"</h4>").appendTo(modalheader);modalheader.appendTo(modalcontent);$('<div class="modal-body"> <p>'+message+'</p> <input id="tags" type="checkbox" value="1" /><label for="tags"><span style="color:red">不再弹出提示框<span></label></div>').appendTo(modalcontent);var modelfooter=$("<div class='modal-footer'></div>").append($('<button type="button" class="btn btn-default btn-cancel btn-sm" data-dismiss="modal">取消</button>')).append($('<button type="button" class="btn btn-primary btn-ok btn-sm" data-dismiss="modal">'+oktext+"</button>"));modelfooter.appendTo(modalcontent);var modal=top.$("<div class='modal fade '></div>").append($("<div class='modal-dialog modal-sm'></div>").append(modalcontent));modal.modal({keyboard:true}).on("hidden.bs.modal",function(e){$(this).detach()});return{on:function(callback){if(callback&&callback instanceof Function){modal.find(".btn-ok").click(function(){if(modal.find("#tags").is(":checked")){$("#myTags").val(modal.find("#tags").val())}callback(true)});modal.find(".btn-cancel").click(function(){callback(false)})}}}}},dialog:{open:function(opt){top.dialog({id:opt.id,title:opt.title,url:opt.url,data:opt.data,width:opt.width,height:opt.height,padding:"2px",onclose:function(){if(opt.closefunc!=""&&typeof(opt.closefunc)=="function"){opt.closefunc(this.returnValue)}if(opt.autoClose){dialog({id:opt.id}).remove()}}}).showModal()},opendialog:function(id,title,url,width,height,closefunc){width="800px";top.dialog({id:id,title:title,url:url,width:width,height:height,onclose:function(){if(closefunc!=""&&typeof(closefunc)=="function"){closefunc(this.returnValue)}},padding:"2px"}).showModal()}},window:{open:function(opts){if(opts){var id=opts.id||"";var title=opts.title||"";var url=opts.url||"";var callback=opts.callback||null;var $window=$("<div class='ccl-window'></div>");var $header=$("<div class='ccl-header'><span class='ccl-title'>"+title+"</span></div>");var $close=$("<button type='button' class='close' data-dismiss='modal'><span aria-hidden='true'>&times;</span><span class='sr-only'>关闭</span></button>");var $iframe=$("<iframe class='ccl-iframe' src='"+url+"'></iframe>");$header.append($close);$window.append($header).append($iframe);var modal=top.$("<div id='"+id+"' class='modal fade'></div>").append($window);modal.data("callback",callback);modal.modal({keyboard:true}).on("hidden.bs.modal",function(e){$(this).detach()});$close.click(function(){if(callback instanceof Function){callback()}})}},close:function(id,args){top.window.$("div.modal-backdrop.fade.in").remove();var $modal=top.$("#"+id);var callback=$modal.data("callback");$modal.detach();if(callback instanceof Function){callback(args)}}}}}(function($){$.fn.HNSelect=function(v){var self=this;v.isFirstSelect=v.isFirstSelect||0;var backup=$(self).clone();if(v.parent_selector==""||v.parent_selector==undefined){return this.each(function(){$.ajax({url:v.url,data:v.data,type:"post",dataType:"json",success:function(json,textStatus){$("option",self).remove();if(v.defaultText!=undefined){$(self).append(v.defaultText)}$.map(json,function(item){$(self).append("<option value='"+item.value+"'>"+item.text+"</option>")});if(1===$("option",this).size()&&$(this).val()===""){$(self).attr("disabled","disabled")}else{$(self).removeAttr("disabled")}if(v.defaultselect!=undefined){$(self).val(v.defaultselect)}if(v.func!=undefined){v.func()}}})})}else{return this.each(function(){$(v.parent_selector).each(function(){$(this).bind("change",function(){if(v.isFirstSelect>1){v.defaultselect=""}var data={};if($(":selected",v.parent_selector).val()!=""){var id=$(v.parent_selector).attr("id");if(v.dataid!=undefined){id=v.dataid}var value=$(":selected",v.parent_selector).val();data[id]=value;$.ajax({url:v.url,data:data,type:"post",dataType:"json",success:function(json,textStatus){var selected_key=$(":selected",self).val();$("option",self).remove();if(v.defaultText!=undefined){$(self).append(v.defaultText)}$.map(json,function(item){$(self).append("<option value='"+item.value+"'>"+item.text+"</option>")});if(1===$("option",self).size()&&$(self).val()===""){$(self).attr("disabled","disabled")}else{$(self).removeAttr("disabled")}$(self).trigger("change");var isContain=false;$.map(json,function(item){if(item.value===v.defaultselect){isContain=true;return}});if(v.defaultselect!=undefined){if(!isContain){v.defaultselect=""}else{$(self).val(v.defaultselect)}}if(v.func!=undefined){v.func()}}})}else{$("option",self).remove();if(v.defaultText!=undefined){$(self).append(v.defaultText)}}});$(this).trigger("change")})})}};$.extend({alert:function(msg,type,callback,delayTime){top.$.topAlert(msg,type,callback,delayTime)},topAlert:function(msg,type,callback,delayTime){if(delayTime){}else{delayTime=2000}var $div=top.$("div.msg-div");if($div==null||$div.length==0){$div=$("<div class='msg-div'></div>");top.$("body").append($div)}var $text=$("<div class='msg-div-text'></div>");if(type=="success"){$text.append("<i class='fa fa-check-circle' style='margin-right:8px;'></i>");$text.css("background-color","#00c0ef")}else{if(type=="error"){alert(msg);if(typeof callback=="function"){callback()}return}else{if(type=="warn"){$text.append("<i class='fa fa-exclamation-triangle' style='margin-right:8px;'></i>");$text.css("background-color","#f39c12")}}}$text.append(msg||"");$div.append($text);$div.show();$text.animate({"margin-left":"0px"});$text.delay(2000).animate({"margin-left":"250px"},function(){$text.remove();if($div.children().length==0){$div.hide();if(typeof callback=="function"){callback()}}})}});$.fn.extend({fuzzySearchComp:function(callback){var selfList=this;return this.each(function(i,obj){var $panel=$('<ul class="fuzzy-search-ul"></ul>');var left=$(this).offset().left;var top=$(this).offset().top+23;$panel.css("left",left+"px");$panel.css("top",top+"px");$("body").append($panel);var fuzzyTimer=null;$(this).bind("keydown",function(){clearTimeout(fuzzyTimer)});$(this).bind("keyup focus click",function(event){clearTimeout(fuzzyTimer);(function(self,$panel){fuzzyTimer=setTimeout(function(){var oldName=self.data("oldName")||"";var compName=$.trim(self.val()).toUpperCase();if(compName==null||compName==""){$panel.hide();return}if(oldName==compName&&$panel.is(":visible")){return}self.data("oldName",compName);if(event.which==37||event.which==38||event.which==39||event.which==40||event.which==13){return}$.post(getRootPath()+"/stdCompinfo/searchCompByName.html",{"compName":compName},function(result){if(result.success){var list=result.rows||[];$panel.children().remove();if(list.length>0){for(var i=0;i<list.length;i++){var comp=list[i]||{};var py=comp.py||"";var name=comp.name||"";var pi=comp.py.indexOf(compName);var ni=comp.name.indexOf(compName);if(pi>=0){var before=py.substring(0,pi);var after=py.substr(pi+compName.length);py=before+"<span class='keyword'>"+compName+"</span>"+after}else{if(ni>=0){var before=name.substring(0,ni);var after=name.substr(ni+compName.length);name=before+"<span class='keyword'>"+compName+"</span>"+after}}var left='<span class="left">'+py+"</span>";var right='<span class="right">'+name+"</span>";var $li=$('<li title="'+comp.name+'">'+left+right+"</li>");$li.data("comp",comp);$panel.append($li)}$panel.children("li:first").addClass("fuzzy-search-focus");$panel.children("li:last").css("border-bottom","0px none");$panel.children("li").hover(function(){$panel.children("li").removeClass("fuzzy-search-focus");$(this).addClass("fuzzy-search-focus")});$panel.children("li").click(function(){var comp=$(this).data("comp");var compCode=comp.code;var compName=comp.name;self.val(compName);$panel.hide();if(callback instanceof Function){callback(compCode)}})}else{$panel.append('<li><span class="left red" style="border-bottom:0px none;font-weight:bold;">没有符合条件的记录！</span></li>')}if($panel.is(":not(:visible)")){$panel.show()}}},"json")},500)})($(this),$panel);event.stopPropagation()});$(this).keyup(function(event){if(event.which==37||event.which==38||event.which==39||event.which==40||event.which==13){var $lis=$panel.children("li");if($panel.is(":visible")&&$lis.length>0){var $curLi=$lis.filter(".fuzzy-search-focus");var $nextLi=null;switch(event.which){case 38:$nextLi=$curLi.prev();if($nextLi.length<=0){$nextLi=$lis.filter(":last")}break;case 40:$nextLi=$curLi.next();if($nextLi.length<=0){$nextLi=$lis.filter(":first")}break;case 13:var comp=$curLi.data("comp");var compCode=comp.code;var compName=comp.name;$(this).val(compName);$panel.hide();if(callback instanceof Function){callback(compCode)}return}if($nextLi.length>0){$curLi.removeClass("fuzzy-search-focus");$nextLi.addClass("fuzzy-search-focus")}}}});$(this).blur(function(){var $curLi=$panel.children("li.fuzzy-search-focus");var comp=$curLi.data("comp")||{};var compCode=comp.code||"";var compName=comp.name||"";$(this).val(compName);$panel.hide();if(callback instanceof Function){callback(compCode)}})})}});$(window).bind("click",function(){$("ul.fuzzy-search-ul").hide()})})(jQuery);var json={"clone":function(param){var jsonObject=null;if(param instanceof Array){jsonObject=[];for(var i=0;i<param.length;i++){jsonObject[i]=json.clone(param[i])}}else{if(typeof param=="object"){jsonObject={};for(var k in param){jsonObject[k]=json.clone(param[k])}}else{jsonObject=param}}return jsonObject},"jsonToString":function(param){var str="",empty=true;if(param instanceof Array){var len=param.length;str="[";for(var i=0;i<len;i++){str+=json.jsonToString(param[i]);i<len-1?str+=",":null}str+="]"}else{if(typeof param=="object"){str="{";for(var k in param){str+='"'+k+'":'+json.jsonToString(param[k])+",";empty=false}!empty?str=str.substring(0,str.length-1):null;str+="}"}else{if(typeof param=="number"){str=param}else{str='"'+param+'"'}}}return str}};Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return format};function formatForm(formid){var fields=$("#"+formid).serialize();var dataResult=decodeURIComponent(fields,true);var tmp=dataResult.replace(/&/g,'",');tmp=tmp.replace(/=/g,':"');var jsonValue="{"+tmp+'"}';var obj=eval("("+jsonValue+")");return obj}function CurentTime(now){var year=now.getFullYear();var month=now.getMonth()+1;var day=now.getDate();var hh=now.getHours();var mm=now.getMinutes();var ss=now.getSeconds();var clock=year+"-";if(month<10){clock+="0"}clock+=month+"-";if(day<10){clock+="0"}clock+=day+" ";return(clock)}function formatAmount(cellvalue,options,row){var f_x=Math.round(cellvalue*100)/100;var s_x=f_x.toString();var pos_decimal=s_x.indexOf(".");if(pos_decimal<0){pos_decimal=s_x.length;s_x+="."}while(s_x.length<=pos_decimal+2){s_x+="0"}return s_x}function formatSelect(select,data){var self=$(select);self.append("<option value=''>请选择</option>");data=uniqueArray(data);console.log("格式化后："+data.length);for(var i in data){var name=typeof(data[i].name)=="undefined"?data[i].projName:data[i].name;self.append("<option value='"+data[i].projId+"'>"+name+"</option>")}self.trigger("change")}function uniqueArray(data){for(var i=1;i<data.length;i++){if(data[i].projId===data[i-1].projId){data.splice(i--,1)}}return data}function getRootPath(){var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPaht=curWwwPath.substring(0,pos);var projectName=pathName.substring(0,pathName.substr(1).indexOf("/")+1);return(localhostPaht+projectName)}function showCompInfo(compCode,compName){$.HN.dialog.opendialog(compCode,"企业详情",getRootPath()+"/stdCompinfo/toCompInfoByCode.html?compCode="+compCode,"800px","510px")}function showDrugInfo(drugCode,drugName){$.HN.dialog.opendialog(drugCode,"药品详情",getRootPath()+"/stdProdDrugInfo/toDrugInfoByCode.html?drugCode="+drugCode,"800px","550px")}function showHospInfo(hospCode){$.HN.dialog.opendialog(hospCode,"医疗机构详情",getRootPath()+"/stdHospInfo/toHospInfoByCode.html?hospCode="+hospCode,"800px","510px")}function drugInfoLink(drugCode,drugName,type){var str="";if(type==1&&drugCode&&drugName){str="<a href=\"javascript:showDrugInfo('"+drugCode+"');\">"+drugName+"</a>"}else{if(drugCode){str="<a href=\"javascript:showDrugInfo('"+drugCode+"');\">"+drugCode+"</a>"}}return str}function compInfoLink(compCode,compName,type){var str="";if(type==1&&compCode&&compName){str="<a href=\"javascript:showCompInfo('"+compCode+"');\">"+compName+"</a>"}else{if(compCode){str="<a href=\"javascript:showCompInfo('"+compCode+"');\">"+compCode+"</a>"}}return str}function hospInfoLink(hospCode,hospName,type){var str="";if(type==1&&hospCode&&hospName){str="<a href=\"javascript:showHospInfo('"+hospCode+"');\">"+hospName+"</a>"}else{if(hospCode){str="<a href=\"javascript:showHospInfo('"+hospCode+"');\">"+hospCode+"</a>"}}return str}function create(){var heightAll=$(window).height();var heightSearch=$(".box").height();var heightButt=$(".bottongroup").height();var heightHeard=$(".jqgrid",".content").offset();var heightTable=255;if(heightHeard!=undefined){heightTable=heightAll-heightHeard.top-heightSearch-10-20;if(heightButt!=null){heightTable=heightAll-heightHeard.top-heightSearch-10-20-heightButt}}if(heightTable>600){heightTable=600}return heightTable}function changeSelectChecked(gridlist,num,value,event){var ids=$(gridlist).jqGrid("getDataIDs");if(!$("#jqg_gridlist_"+num).is(":checked")){if(event.which==13||(event.which==8)){return}$(gridlist).setSelection(ids[--num],true)}if(value.length==0&&$("#jqg_gridlist_"+num).is(":checked")){$(gridlist).setSelection(ids[--num],true)}}$.extend({StandardPost:function(url,args){var form=document.createElement("form");form.method="post";form.action=url;form.style.display="none";var input;$.each(args,function(key,value){input=document.createElement("textarea");input.name=key;input.value=value;form.appendChild(input)});document.body.appendChild(form);form.submit();return form}});$(function(){$(document).keydown(function(event){if(event.keyCode==13){$("#search").click()}});$("#clear").on("click",function(){$("#searchForm :text,input[type=number],#searchForm select:not(.noClear)").val("");$("#searchForm :radio[id^=all]").prop("checked",true)})});function numberDHCut(str){str=str+"";var numLength=str.split(".")[0].length;var indexArray=[];var result="";for(var i=1;i<numLength;i++){if(i%3==0){indexArray.push(numLength-i-1)}}for(var i=0;i<str.length;i++){result+=str[i];if(indexArray.indexOf(i)>-1){result+=","}}return result};