$(document).ready(function(){(function(bootstro,$,undefined){var $elements;var count;var popovers=[];var activeIndex=null;var bootstrapVersion=3;var defaults={nextButtonText:"Next &raquo;",prevButtonText:"&laquo; Prev",finishButtonText:'<i class="icon-ok"></i> Ok I got it, get back to the site',stopOnBackdropClick:true,stopOnEsc:true,margin:100,};var settings;function is_entirely_visible($elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$elem.offset().top;var elemBottom=elemTop+$elem.height();return((elemBottom>=docViewTop)&&(elemTop<=docViewBottom)&&(elemBottom<=docViewBottom)&&(elemTop>=docViewTop))}function add_nav_btn(content,i){var $el=get_element(i);var nextButton,prevButton,finishButton,defaultBtnClass;if(bootstrapVersion==2){defaultBtnClass="btn btn-primary btn-mini"}else{defaultBtnClass="btn btn-primary btn-xs"}content=content+"<div class='bootstro-nav-wrapper'>";if($el.attr("data-bootstro-nextButton")){nextButton=$el.attr("data-bootstro-nextButton")}else{if($el.attr("data-bootstro-nextButtonText")){nextButton='<button class="'+defaultBtnClass+' bootstro-next-btn">'+$el.attr("data-bootstro-nextButtonText")+"</button>"}else{if(typeof settings.nextButton!="undefined"){nextButton=settings.nextButton}else{nextButton='<button class="'+defaultBtnClass+' bootstro-next-btn">'+settings.nextButtonText+"</button>"}}}if($el.attr("data-bootstro-prevButton")){prevButton=$el.attr("data-bootstro-prevButton")}else{if($el.attr("data-bootstro-prevButtonText")){prevButton='<button class="'+defaultBtnClass+' bootstro-prev-btn">'+$el.attr("data-bootstro-prevButtonText")+"</button>"}else{if(typeof settings.prevButton!="undefined"){prevButton=settings.prevButton}else{prevButton='<button class="'+defaultBtnClass+' bootstro-prev-btn">'+settings.prevButtonText+"</button>"}}}if($el.attr("data-bootstro-finishButton")){finishButton=$el.attr("data-bootstro-finishButton")}else{if($el.attr("data-bootstro-finishButtonText")){finishButton='<button class="'+defaultBtnClass+' bootstro-finish-btn">'+$el.attr("data-bootstro-finishButtonText")+"</button>"}else{if(typeof settings.finishButton!="undefined"){finishButton=settings.finishButton}else{finishButton='<button class="'+defaultBtnClass+' bootstro-finish-btn">'+settings.finishButtonText+"</button>"}}}if(count!=1){if(i==0){content=content+nextButton}else{if(i==count-1){content=content+prevButton}else{content=content+nextButton+prevButton}}}content=content+"</div>";content=content+'<div class="bootstro-finish-btn-wrapper">'+finishButton+"</div>";return content}process_items=function(popover){var selectorArr=[];$.each(popover,function(t,e){$.each(e,function(j,attr){$(e.selector).attr("data-bootstro-"+j,attr)});if($(e.selector).is(":visible")){selectorArr.push(e.selector)}});return selectorArr.join(",")};get_element=function(i){if($elements.filter("[data-bootstro-step="+i+"]").size()>0){return $elements.filter("[data-bootstro-step="+i+"]")}else{return $elements.eq(i)}};get_popup=function(i){var p={};var $el=get_element(i);var t="";if(count>1){t="<span class='label label-success'>"+(i+1)+"/"+count+"</span>"}p.title=$el.attr("data-bootstro-title")||"";if(p.title!=""&&t!=""){p.title=t+" - "+p.title}else{if(p.title==""){p.title=t}}p.content=$el.attr("data-bootstro-content")||"";p.content=add_nav_btn(p.content,i);p.placement=$el.attr("data-bootstro-placement")||"top";var style="";if($el.attr("data-bootstro-width")){p.width=$el.attr("data-bootstro-width");style=style+"width:"+$el.attr("data-bootstro-width")+";"}if($el.attr("data-bootstro-height")){p.height=$el.attr("data-bootstro-height");style=style+"height:"+$el.attr("data-bootstro-height")+";"}p.trigger="manual";p.html=$el.attr("data-bootstro-html")||"top";if($el.attr("data-bootstro-container")){p.container=$el.attr("data-bootstro-container")}p.template='<div class="popover" style="'+style+'"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div>'+"</div>";return p};bootstro.destroy_popover=function(i){var i=i||0;if(i!="all"){var $el=get_element(i);$el.popover("destroy").removeClass("bootstro-highlight")}};bootstro.stop=function(){bootstro.destroy_popover(activeIndex);bootstro.unbind();$("div.bootstro-backdrop").remove();if(typeof settings.onExit=="function"){settings.onExit.call(this,{idx:activeIndex})}};bootstro.go_to=function(idx){bootstro.destroy_popover(activeIndex);if(count!=0){var p=get_popup(idx);var $el=get_element(idx);$el.popover(p).popover("show");var docviewTop=$(window).scrollTop();var top=Math.min($(".popover.in").offset().top,$el.offset().top);var topDistance=top-docviewTop;if(topDistance<settings.margin){$("html,body").animate({scrollTop:top-settings.margin},"slow")}else{if(!is_entirely_visible($(".popover.in"))||!is_entirely_visible($el)){$("html,body").animate({scrollTop:top-settings.margin},"slow")}}$el.addClass("bootstro-highlight");activeIndex=idx}};bootstro.next=function(){if(activeIndex+1==count){if(typeof settings.onComplete=="function"){settings.onComplete.call(this,{idx:activeIndex})}}else{bootstro.go_to(activeIndex+1);if(typeof settings.onStep=="function"){settings.onStep.call(this,{idx:activeIndex,direction:"next"})}}};bootstro.prev=function(){if(activeIndex==0){}else{bootstro.go_to(activeIndex-1);if(typeof settings.onStep=="function"){settings.onStep.call(this,{idx:activeIndex,direction:"prev"})}}};bootstro._start=function(selector){selector=selector||".bootstro";$elements=$(selector);count=$elements.size();if(count>0&&$("div.bootstro-backdrop").length===0){$('<div class="bootstro-backdrop"></div>').appendTo("body");bootstro.bind();bootstro.go_to(0)}};bootstro.start=function(selector,options){settings=$.extend(true,{},defaults);$.extend(settings,options||{});if(typeof settings.url!="undefined"){$.ajax({url:settings.url,success:function(data){if(data.success){var popover=data.result;selector=process_items(popover);bootstro._start(selector)}}})}else{if(typeof settings.items!="undefined"){bootstro._start(process_items(settings.items))}else{bootstro._start(selector)}}};bootstro.set_bootstrap_version=function(ver){bootstrapVersion=ver};bootstro.bind=function(){bootstro.unbind();$("html").on("click.bootstro",".bootstro-next-btn",function(e){bootstro.next();e.preventDefault();return false});$("html").on("click.bootstro",".bootstro-prev-btn",function(e){bootstro.prev();e.preventDefault();return false});$("html").on("click.bootstro",".bootstro-finish-btn",function(e){e.preventDefault();bootstro.stop()});if(settings.stopOnBackdropClick){$("html").on("click.bootstro","div.bootstro-backdrop",function(e){if($(e.target).hasClass("bootstro-backdrop")){bootstro.stop()}})}$(document).on("keydown.bootstro",function(e){var code=(e.keyCode?e.keyCode:e.which);if(code==39||code==40){bootstro.next()}else{if(code==37||code==38){bootstro.prev()}else{if(code==27&&settings.stopOnEsc){bootstro.stop()}}}})};bootstro.unbind=function(){$("html").unbind("click.bootstro");$(document).unbind("keydown.bootstro")}}(window.bootstro=window.bootstro||{},jQuery))});